
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pynapple.core.time_series &#8212; pynapple 0.10.2 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_contributors.css?v=f079e67e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=f2caec9a" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../_static/documentation_options.js?v=11e62b30"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=c57da192"></script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/pynapple/core/time_series';</script>
    <link rel="icon" href="../../../_static/Pynapple_final_icon.png"/>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.10.2" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
    
    <img src="../../../_static/Pynapple_final_logo.png" class="logo__image only-light" alt="pynapple 0.10.2 documentation - Home"/>
    <img src="../../../_static/Pynapple_final_logo.png" class="logo__image only-dark pst-js-only" alt="pynapple 0.10.2 documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../installing.html">
    Installing
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../user_guide.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../examples.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../api.html">
    API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../about.html">
    About us
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../../releases.html">
    Releases
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../../external.html">
    External projects
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../../pynajax.html">
    GPU acceleration
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../../citing.html">
    Citing
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pynapple-org/pynapple" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/thepynapple" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../installing.html">
    Installing
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../user_guide.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../examples.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../api.html">
    API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../about.html">
    About us
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../releases.html">
    Releases
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../external.html">
    External projects
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../pynajax.html">
    GPU acceleration
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../citing.html">
    Citing
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pynapple-org/pynapple" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/thepynapple" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">pynapple.core.time_series</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for pynapple.core.time_series</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">Pynapple time series are containers specialized for neurophysiological time series.</span>
<span class="sd">They provides standardized time representation, plus various functions for manipulating times series with identical sampling frequency.</span>

<span class="sd">Multiple time series object are available depending on the shape of the data.</span>

<span class="sd">- `TsdTensor` : for data with of more than 2 dimensions, typically movies.</span>
<span class="sd">- `TsdFrame` : for column-based data. It can be easily converted to a pandas.DataFrame. Columns can be labelled and selected similar to pandas.</span>
<span class="sd">- `Tsd` : One-dimensional time series. It can be converted to a pandas.Series.</span>
<span class="sd">- `Ts` : For timestamps data only.</span>

<span class="sd">Most of the same functions are available through all classes. Objects behaves like numpy.ndarray. Slicing can be done the same way for example</span>
<span class="sd">`tsd[0:10]` returns the first 10 rows. Similarly, you can call any numpy functions like `np.mean(tsd, 1)`.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">numbers</span> <span class="kn">import</span> <span class="n">Number</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">numpy.lib.mixins</span> <span class="kn">import</span> <span class="n">NDArrayOperatorsMixin</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">from</span> <span class="nn">._core_functions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">_bin_average</span><span class="p">,</span>
    <span class="n">_convolve</span><span class="p">,</span>
    <span class="n">_count</span><span class="p">,</span>
    <span class="n">_dropna</span><span class="p">,</span>
    <span class="n">_restrict</span><span class="p">,</span>
    <span class="n">_threshold</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.base_class</span> <span class="kn">import</span> <span class="n">_Base</span>
<span class="kn">from</span> <span class="nn">.interval_set</span> <span class="kn">import</span> <span class="n">IntervalSet</span>
<span class="kn">from</span> <span class="nn">.metadata_class</span> <span class="kn">import</span> <span class="n">_MetadataMixin</span><span class="p">,</span> <span class="n">add_meta_docstring</span><span class="p">,</span> <span class="n">add_or_convert_metadata</span>
<span class="kn">from</span> <span class="nn">.time_index</span> <span class="kn">import</span> <span class="n">TsIndex</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">_concatenate_tsd</span><span class="p">,</span>
    <span class="n">_convert_iter_to_str</span><span class="p">,</span>
    <span class="n">_get_terminal_size</span><span class="p">,</span>
    <span class="n">_split_tsd</span><span class="p">,</span>
    <span class="n">_TsdFrameSliceHelper</span><span class="p">,</span>
    <span class="n">add_docstring</span><span class="p">,</span>
    <span class="n">convert_to_array</span><span class="p">,</span>
    <span class="n">is_array_like</span><span class="p">,</span>
    <span class="n">modifies_time_axis</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_class</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Select the right time series object and return the class</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : numpy.ndarray</span>
<span class="sd">        The data to hold in the time series object</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Class</span>
<span class="sd">        The class</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Tsd</span>
    <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">TsdFrame</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">TsdTensor</span>


<span class="k">def</span> <span class="nf">_initialize_tsd_output</span><span class="p">(</span>
    <span class="n">input_object</span><span class="p">,</span>
    <span class="n">values</span><span class="p">,</span>
    <span class="n">time_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">time_support</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">drop_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the output object for time series data, ensuring proper alignment of time indices</span>
<span class="sd">    and handling metadata when applicable.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    input_object : Tsd | TsdFrame | TsdTensor</span>
<span class="sd">        Input object, typically a `Tsd`, `TsdFrame` or `TsdTensor`, used to extract time indices and metadata</span>
<span class="sd">        if not provided explicitly.</span>
<span class="sd">    values : array-like</span>
<span class="sd">        Output data, which can be a NumPy array or an array-like object compatible with `Tsd` or `TsdFrame`.</span>
<span class="sd">    time_index : array-like, optional</span>
<span class="sd">        Time indices for the output data. If not provided, the indices are extracted from `input_object`.</span>
<span class="sd">    time_support : IntervalSet, optional</span>
<span class="sd">        Time support (epoch) for the output. If not provided, the time support is extracted from `input_object`.</span>
<span class="sd">    kwargs : dict, optional</span>
<span class="sd">        Additional keyword arguments for constructing the output object. Supports `columns` and `metadata`</span>
<span class="sd">        for `TsdFrame` objects.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    object</span>
<span class="sd">        Initialized TSD object (`Tsd`, `TsdFrame`, or equivalent) with the specified time indices, data,</span>
<span class="sd">        and metadata, or the original `values` object if it is not array-like.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - If output is a `TsdFrame` and `input_object` is also a `TsdFrame` with matching shapes, the columns and metadata</span>
<span class="sd">      are propagated from input to output, unless explicitly provided in `kwargs`.</span>
<span class="sd">    - If `time_index` and `time_support` are not provided, they are extracted from `input_object`.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    # Example usage with TsdFrame</span>
<span class="sd">    out = _initialize_tsd_output(input_object=tsd_frame, values=data_array, time_index=time_array, time_support=epoch, kwargs={&quot;columns&quot;: cols})</span>

<span class="sd">    # Example usage with NumPy array</span>
<span class="sd">    out = _initialize_tsd_output(input_object=tsd_obj, values=numpy_array)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span> <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_array_like</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
        <span class="c1"># if time and ep are passed use them, otherwise strip from inp</span>
        <span class="n">time_index</span> <span class="o">=</span> <span class="n">input_object</span><span class="o">.</span><span class="n">index</span> <span class="k">if</span> <span class="n">time_index</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">time_index</span>

        <span class="k">if</span> <span class="n">time_index</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="c1"># grab time support</span>
            <span class="n">time_support</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">input_object</span><span class="o">.</span><span class="n">time_support</span> <span class="k">if</span> <span class="n">time_support</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">time_support</span>
            <span class="p">)</span>

            <span class="bp">cls</span> <span class="o">=</span> <span class="n">_get_class</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

            <span class="c1"># if out will be a tsdframe implement kwargs logic</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">cls</span> <span class="ow">is</span> <span class="n">TsdFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">drop_metadata</span><span class="p">):</span>
                <span class="c1"># get eventual setting</span>
                <span class="n">cols</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;columns&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">metadata</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

                <span class="c1"># if input is tsdframe and has the shape grab metadata and cols if</span>
                <span class="c1"># not already passed in kwargs</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_object</span><span class="p">,</span> <span class="n">TsdFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">input_object</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="n">cols</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">cols</span>
                        <span class="k">if</span> <span class="n">cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                        <span class="k">else</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">input_object</span><span class="p">,</span> <span class="s2">&quot;columns&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">metadata</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">metadata</span>
                        <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                        <span class="k">else</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">input_object</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="p">)</span>

                <span class="c1"># update the kwargs</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="n">cols</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="p">})</span>

            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">time_index</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">time_support</span><span class="o">=</span><span class="n">time_support</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">values</span>


<span class="k">class</span> <span class="nc">_BaseTsd</span><span class="p">(</span><span class="n">_Base</span><span class="p">,</span> <span class="n">NDArrayOperatorsMixin</span><span class="p">,</span> <span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract base class for time series objects.</span>
<span class="sd">    Implement most of the shared functions across concrete classes `Tsd`, `TsdFrame`, `TsdTensor`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An array of the time series data&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">time_units</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">time_support</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">load_array</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">time_units</span><span class="p">,</span> <span class="n">time_support</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">load_array</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">convert_to_array</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_array_like</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;Data should be array-like, i.e. be indexable, iterable and, have attributes &quot;</span>
                    <span class="s2">&quot;`shape`, `ndim` and, `dtype`).&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">d</span>

        <span class="k">assert</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;Length of values </span><span class="si">{}</span><span class="s2"> does not match length of index </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time_support</span><span class="p">,</span> <span class="n">IntervalSet</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
            <span class="n">starts</span> <span class="o">=</span> <span class="n">time_support</span><span class="o">.</span><span class="n">start</span>
            <span class="n">ends</span> <span class="o">=</span> <span class="n">time_support</span><span class="o">.</span><span class="n">end</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">_restrict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">TsIndex</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">d</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                <span class="n">time_support</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">time_support</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">dtype</span>

    <span class="k">def</span> <span class="nf">_define_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_index</span><span class="p">,</span> <span class="n">time_support</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define a new class instance.</span>

<span class="sd">        Optional parameters for initialization are either passed to the function or are grabbed from self.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_initialize_tsd_output</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">values</span><span class="p">,</span>
            <span class="n">time_index</span><span class="o">=</span><span class="n">time_index</span><span class="p">,</span>
            <span class="n">time_support</span><span class="o">=</span><span class="n">time_support</span><span class="p">,</span>
            <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;setter for time series&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">_BaseTsd</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">d</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Allow numpy functions to be attached as attributes of Tsd objects&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="n">np_func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">method</span>

        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
            <span class="s2">&quot;Time series object does not have the attribute </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">d</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ndim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ndim</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">size</span>

    <span class="k">def</span> <span class="nf">__array__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__array_ufunc__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ufunc</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;__call__&quot;</span><span class="p">:</span>
            <span class="n">new_args</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">n_object</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
                    <span class="n">new_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                    <span class="n">n_object</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

            <span class="c1"># Meant to prevent addition of two Tsd for example</span>
            <span class="k">if</span> <span class="n">n_object</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">NotImplemented</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">ufunc</span><span class="p">(</span><span class="o">*</span><span class="n">new_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">_initialize_tsd_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="nf">__array_function__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">types</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">func</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">lexsort</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sort_complex</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">partition</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">argpartition</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>

        <span class="c1"># This should be implemented at some point</span>
        <span class="k">if</span> <span class="n">func</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">take_along_axis</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">extract</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">compress</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">choose</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>

        <span class="k">if</span> <span class="n">func</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dsplit</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">hsplit</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">vsplit</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">_split_tsd</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">func</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">return</span> <span class="n">_concatenate_tsd</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">new_args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
                <span class="n">new_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">_implementation</span><span class="p">(</span><span class="o">*</span><span class="n">new_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">modifies_time_axis</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">new_args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_initialize_tsd_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">drop_metadata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">as_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out: array-like</span>
<span class="sd">            _</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>

    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out: array-like</span>
<span class="sd">            _</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>

    <span class="k">def</span> <span class="nf">to_numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the data as a numpy.ndarray.</span>

<span class="sd">        Mostly useful for matplotlib plotting when calling `plot(tsd)`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">bin_average</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bin_size</span><span class="p">,</span> <span class="n">ep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_units</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Bin the data by averaging points within bin_size</span>
<span class="sd">        bin_size should be seconds unless specified.</span>
<span class="sd">        If no epochs is passed, the data will be binned based on the time support.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bin_size : float</span>
<span class="sd">            The bin size (default is second)</span>
<span class="sd">        ep : None or IntervalSet, optional</span>
<span class="sd">            IntervalSet to restrict the operation</span>
<span class="sd">        time_units : str, optional</span>
<span class="sd">            Time units of bin size (&#39;us&#39;, &#39;ms&#39;, &#39;s&#39; [default])</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out: Tsd, TsdFrame, TsdTensor</span>
<span class="sd">            A Tsd object indexed by the center of the bins and holding the averaged data points.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        This example shows how to bin data within bins of 0.1 second.</span>

<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; tsd = nap.Tsd(t=np.arange(100), d=np.random.rand(100))</span>
<span class="sd">        &gt;&gt;&gt; bintsd = tsd.bin_average(0.1)</span>

<span class="sd">        An epoch can be specified:</span>

<span class="sd">        &gt;&gt;&gt; ep = nap.IntervalSet(start = 10, end = 80, time_units = &#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; bintsd = tsd.bin_average(0.1, ep=ep)</span>

<span class="sd">        And bintsd automatically inherit ep as time support:</span>

<span class="sd">        &gt;&gt;&gt; bintsd.time_support</span>
<span class="sd">        &gt;&gt;&gt;    start    end</span>
<span class="sd">        &gt;&gt;&gt; 0  10.0     80.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ep</span><span class="p">,</span> <span class="n">IntervalSet</span><span class="p">):</span>
            <span class="n">ep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_support</span>

        <span class="n">bin_size</span> <span class="o">=</span> <span class="n">TsIndex</span><span class="o">.</span><span class="n">format_timestamps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">bin_size</span><span class="p">]),</span> <span class="n">time_units</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">time_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
        <span class="n">data_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>
        <span class="n">starts</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">start</span>
        <span class="n">ends</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">end</span>

        <span class="n">t</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">_bin_average</span><span class="p">(</span><span class="n">time_array</span><span class="p">,</span> <span class="n">data_array</span><span class="p">,</span> <span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">,</span> <span class="n">bin_size</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_initialize_tsd_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">time_index</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">time_support</span><span class="o">=</span><span class="n">ep</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dropna</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_time_support</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Drop every row containing NaNs. By default, the time support is updated to start and end around the time points that are non NaNs.</span>
<span class="sd">        To change this behavior, you can set update_time_support=False.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        update_time_support : bool, optional</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Tsd, TsdFrame or TsdTensor</span>
<span class="sd">            The time series without the NaNs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">update_time_support</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Argument update_time_support should be of type bool&quot;</span><span class="p">)</span>

        <span class="n">time_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
        <span class="n">data_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>
        <span class="n">starts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_support</span><span class="o">.</span><span class="n">start</span>
        <span class="n">ends</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_support</span><span class="o">.</span><span class="n">end</span>

        <span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">starts</span><span class="p">,</span> <span class="n">ends</span> <span class="o">=</span> <span class="n">_dropna</span><span class="p">(</span>
            <span class="n">time_array</span><span class="p">,</span> <span class="n">data_array</span><span class="p">,</span> <span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">,</span> <span class="n">update_time_support</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">update_time_support</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_array_like</span><span class="p">(</span><span class="n">starts</span><span class="p">)</span> <span class="ow">and</span> <span class="n">is_array_like</span><span class="p">(</span><span class="n">ends</span><span class="p">):</span>
                <span class="n">ep</span> <span class="o">=</span> <span class="n">IntervalSet</span><span class="p">(</span><span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ep</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_support</span>

        <span class="k">return</span> <span class="n">_initialize_tsd_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">time_index</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">time_support</span><span class="o">=</span><span class="n">ep</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">convolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">ep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the discrete linear convolution of the time series with a one dimensional sequence.</span>

<span class="sd">        A parameter ep can control the epochs for which the convolution will apply. Otherwise the convolution is made over the time support.</span>

<span class="sd">        This function assume a constant sampling rate of the time series.</span>

<span class="sd">        The only mode supported is full. The returned object is trimmed to match the size of the original object. The parameter trim controls which side the trimming operates. Default is &#39;both&#39;.</span>

<span class="sd">        See the numpy documentation here : https://numpy.org/doc/stable/reference/generated/numpy.convolve.html</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        array : array-like</span>
<span class="sd">            1-D or 2-D array with kernel(s) to be used for convolution.</span>
<span class="sd">            First dimension is assumed to be time.</span>
<span class="sd">        ep : None, optional</span>
<span class="sd">            The epochs to apply the convolution</span>
<span class="sd">        trim : str, optional</span>
<span class="sd">            The side on which to trim the output of the convolution (&#39;left&#39;, &#39;right&#39;, &#39;both&#39; [default])</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Tsd, TsdFrame or TsdTensor</span>
<span class="sd">            The convolved time series</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_array_like</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span>
                <span class="s2">&quot;Input should be a numpy array (or jax array if pynajax is installed).&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Input array is length 0&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Array should be 1 or 2 dimension.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">trim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Unknow argument. trim should be &#39;both&#39;, &#39;left&#39; or &#39;right&#39;.&quot;</span><span class="p">)</span>

        <span class="n">time_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
        <span class="n">data_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>

        <span class="k">if</span> <span class="n">ep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_support</span>
            <span class="n">starts</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">start</span>
            <span class="n">ends</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">end</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ep</span><span class="p">,</span> <span class="n">IntervalSet</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;ep should be an object of type IntervalSet&quot;</span><span class="p">)</span>
            <span class="n">starts</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">start</span>
            <span class="n">ends</span> <span class="o">=</span> <span class="n">ep</span><span class="o">.</span><span class="n">end</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">_restrict</span><span class="p">(</span><span class="n">time_array</span><span class="p">,</span> <span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">)</span>
            <span class="n">time_array</span> <span class="o">=</span> <span class="n">time_array</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">data_array</span> <span class="o">=</span> <span class="n">data_array</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

        <span class="n">new_data_array</span> <span class="o">=</span> <span class="n">_convolve</span><span class="p">(</span><span class="n">time_array</span><span class="p">,</span> <span class="n">data_array</span><span class="p">,</span> <span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">trim</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_initialize_tsd_output</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">new_data_array</span><span class="p">,</span> <span class="n">time_index</span><span class="o">=</span><span class="n">time_array</span><span class="p">,</span> <span class="n">time_support</span><span class="o">=</span><span class="n">ep</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">smooth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">windowsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_units</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">size_factor</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Smooth a time series with a gaussian kernel.</span>

<span class="sd">        `std` is the standard deviation of the gaussian kernel in units of time.</span>
<span class="sd">        If only `std` is passed, the function will compute the standard deviation and size in number</span>
<span class="sd">        of time points automatically based on the sampling rate of the time series.</span>
<span class="sd">        For example, if the time series `tsd` has a sample rate of 100 Hz and `std` is 50 ms,</span>
<span class="sd">        the standard deviation will be converted to an integer through</span>
<span class="sd">        `tsd.rate * std = int(100 * 0.05) = 5`.</span>

<span class="sd">        If `windowsize` is None, the function will select a kernel size as 100 times</span>
<span class="sd">        the std in number of time points. This behavior can be controlled with the</span>
<span class="sd">        parameter `size_factor`.</span>

<span class="sd">        `norm` set to True normalizes the gaussian kernel to sum to 1.</span>

<span class="sd">        In the following example, a time series `tsd` with a sampling rate of 100 Hz</span>
<span class="sd">        is convolved with a gaussian kernel. The standard deviation is</span>
<span class="sd">        0.05 second and the windowsize is 2 second. When instantiating the gaussian kernel</span>
<span class="sd">        from scipy, it corresponds to parameters `M = 200` and `std=5`</span>

<span class="sd">            &gt;&gt;&gt; tsd.smooth(std=0.05, windowsize=2, time_units=&#39;s&#39;, norm=False)</span>

<span class="sd">        This line is equivalent to :</span>

<span class="sd">            &gt;&gt;&gt; from scipy.signal.windows import gaussian</span>
<span class="sd">            &gt;&gt;&gt; kernel = gaussian(M = 200, std=5)</span>
<span class="sd">            &gt;&gt;&gt; tsd.convolve(window)</span>

<span class="sd">        It is generally a good idea to visualize the kernel before applying any convolution.</span>

<span class="sd">        See the scipy documentation for the [gaussian window](https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.windows.gaussian.html)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        std : Number</span>
<span class="sd">            Standard deviation in units of time</span>
<span class="sd">        windowsize : Number</span>
<span class="sd">            Size of the gaussian window in units of time.</span>
<span class="sd">        time_units : str, optional</span>
<span class="sd">            The time units in which std and windowsize are specified (&#39;us&#39;, &#39;ms&#39;, &#39;s&#39; [default]).</span>
<span class="sd">        size_factor : int, optional</span>
<span class="sd">            How long should be the kernel size as a function of the standard deviation. Default is 100.</span>
<span class="sd">            Bypassed if windowsize is used.</span>
<span class="sd">        norm : bool, optional</span>
<span class="sd">            Whether to normalized the gaussian kernel or not. Default is `True`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Tsd, TsdFrame, TsdTensor</span>
<span class="sd">            Time series convolved with a gaussian kernel</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;std should be type int or float&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size_factor</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;size_factor should be of type int&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;norm should be of type boolean&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time_units</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;time_units should be of type str&quot;</span><span class="p">)</span>

        <span class="n">std</span> <span class="o">=</span> <span class="n">TsIndex</span><span class="o">.</span><span class="n">format_timestamps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">std</span><span class="p">]),</span> <span class="n">time_units</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">std_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rate</span> <span class="o">*</span> <span class="n">std</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">windowsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">windowsize</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;windowsize should be type int or float&quot;</span><span class="p">)</span>
            <span class="n">windowsize</span> <span class="o">=</span> <span class="n">TsIndex</span><span class="o">.</span><span class="n">format_timestamps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">windowsize</span><span class="p">]),</span> <span class="n">time_units</span><span class="p">)[</span>
                <span class="mi">0</span>
            <span class="p">]</span>
            <span class="n">M</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rate</span> <span class="o">*</span> <span class="n">windowsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">std_size</span> <span class="o">*</span> <span class="n">size_factor</span>

        <span class="k">if</span> <span class="n">M</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">M</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">window</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span><span class="n">M</span><span class="o">=</span><span class="n">M</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="n">std_size</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
            <span class="n">window</span> <span class="o">=</span> <span class="n">window</span> <span class="o">/</span> <span class="n">window</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">decimate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">down</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">filter_type</span><span class="o">=</span><span class="s2">&quot;iir&quot;</span><span class="p">,</span> <span class="n">ep</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Downsample the time series by an integer factor after an antialiasing filter.</span>

<span class="sd">        As default, applies an antialiasing Chebyshev type I filter and downsample.</span>
<span class="sd">        The filter is a low pass-filter, if ``filter_type`` is set to &quot;fir&quot;,</span>
<span class="sd">        applies a 30 point filter with Hamming window.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        down : int</span>
<span class="sd">            The down-sampling factor.</span>
<span class="sd">        order : int, optional</span>
<span class="sd">            The order of the filter. Default is 8.</span>
<span class="sd">        filter_type : literal, &quot;iir&quot; or &quot;fir&quot;.</span>
<span class="sd">            The filter type. Default is &quot;iir&quot;.</span>
<span class="sd">        ep: IntervalSet</span>
<span class="sd">            The epoch over which applying the decimate algorithm.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        .. plot::</span>
<span class="sd">            :include-source: True</span>
<span class="sd">            :caption: Downsample with decimate</span>

<span class="sd">            &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; noisy_data = np.random.rand(100) + np.sin(np.linspace(0, 2 * np.pi, 100))</span>
<span class="sd">            &gt;&gt;&gt; tsd = nap.Tsd(t=np.arange(100), d=noisy_data)</span>
<span class="sd">            &gt;&gt;&gt; new_tsd = tsd.decimate(down=4)</span>
<span class="sd">            &gt;&gt;&gt; plt.plot(tsd, color=&quot;k&quot;, label=&quot;original&quot;) #doctest: +ELLIPSIS</span>
<span class="sd">            [&lt;matplotlib.lines.Line2D at ...</span>
<span class="sd">            &gt;&gt;&gt; plt.plot(new_tsd, color=&quot;r&quot;, marker=&quot;o&quot;, label=&quot;decimate&quot;) #doctest: +ELLIPSIS</span>
<span class="sd">            [&lt;matplotlib.lines.Line2D at ...</span>
<span class="sd">            &gt;&gt;&gt; plt.plot(tsd[::4], color=&quot;g&quot;, marker=&quot;o&quot;, label=&quot;naive downsample&quot;) #doctest: +ELLIPSIS</span>
<span class="sd">            [&lt;matplotlib.lines.Line2D at ...</span>
<span class="sd">            &gt;&gt;&gt; plt.legend() #doctest: +ELLIPSIS</span>
<span class="sd">            &lt;matplotlib.legend.Legend at ...</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">down</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid value for &#39;down&#39;: Parameter &#39;down&#39; should be of type int.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">order</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid value for &#39;order&#39;: Parameter &#39;order&#39; should be a positive int.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">filter_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;fir&quot;</span><span class="p">,</span> <span class="s2">&quot;iir&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;&#39;filter_type&#39; should be one of &#39;fir&#39;, &#39;iir&#39;.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_support</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ep</span><span class="p">,</span> <span class="n">IntervalSet</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;ep should be an object of type IntervalSet&quot;</span><span class="p">)</span>

        <span class="c1"># apply scipy filter</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">n_vals</span> <span class="o">=</span> <span class="n">_count</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">ep</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">ep</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">deltas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n_vals</span> <span class="o">/</span> <span class="n">down</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">tot_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">deltas</span><span class="p">)</span>
        <span class="n">new_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">tot_samples</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
        <span class="n">new_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">tot_samples</span><span class="p">)</span>
        <span class="n">i_start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ep</span><span class="p">,</span> <span class="n">deltas</span><span class="p">):</span>
            <span class="n">slc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_slice</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">end</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1"># TODO: remove conversion when add jax backend is available</span>
            <span class="n">new_data</span><span class="p">[</span><span class="n">i_start</span> <span class="p">:</span> <span class="n">i_start</span> <span class="o">+</span> <span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">decimate</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">slc</span><span class="p">]),</span>
                <span class="n">down</span><span class="p">,</span>
                <span class="n">n</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
                <span class="n">ftype</span><span class="o">=</span><span class="n">filter_type</span><span class="p">,</span>
                <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">zero_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">new_time</span><span class="p">[</span><span class="n">i_start</span> <span class="p">:</span> <span class="n">i_start</span> <span class="o">+</span> <span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">slc</span><span class="p">][::</span><span class="n">down</span><span class="p">]</span>
            <span class="n">i_start</span> <span class="o">+=</span> <span class="n">d</span>

        <span class="k">return</span> <span class="n">_initialize_tsd_output</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">new_data</span><span class="p">,</span> <span class="n">time_index</span><span class="o">=</span><span class="n">new_time</span><span class="p">,</span> <span class="n">time_support</span><span class="o">=</span><span class="n">ep</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">ep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrapper of the numpy linear interpolation method. See [numpy interpolate](https://numpy.org/doc/stable/reference/generated/numpy.interp.html)</span>
<span class="sd">        for an explanation of the parameters.</span>
<span class="sd">        The argument ts should be Ts, Tsd, TsdFrame, TsdTensor to ensure interpolating from sorted timestamps in the right unit,</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ts : Ts, Tsd, TsdFrame or TsdTensor</span>
<span class="sd">            The object holding the timestamps</span>
<span class="sd">        ep : IntervalSet, optional</span>
<span class="sd">            The epochs to use to interpolate. If None, the time support of Tsd is used.</span>
<span class="sd">        left : None, optional</span>
<span class="sd">            Value to return for ts &lt; tsd[0], default is tsd[0].</span>
<span class="sd">        right : None, optional</span>
<span class="sd">            Value to return for ts &gt; tsd[-1], default is tsd[-1].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">_Base</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span>
                <span class="s2">&quot;First argument should be an instance of Ts, Tsd, TsdFrame or TsdTensor&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Argument left should be of type float or int&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Argument right should be of type float or int&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_support</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ep</span><span class="p">,</span> <span class="n">IntervalSet</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;ep should be an object of type IntervalSet&quot;</span><span class="p">)</span>

        <span class="n">new_t</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">restrict</span><span class="p">(</span><span class="n">ep</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>

        <span class="n">new_shape</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">new_t</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_t</span><span class="p">),)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="p">)</span>
        <span class="n">new_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">new_shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ep</span><span class="p">)):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">ts</span><span class="o">.</span><span class="n">get_slice</span><span class="p">(</span><span class="n">ep</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ep</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])]</span>
            <span class="n">xp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_slice</span><span class="p">(</span><span class="n">ep</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ep</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])]</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_slice</span><span class="p">(</span><span class="n">ep</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ep</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">xp</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">new_d</span><span class="p">[</span><span class="n">start</span> <span class="p">:</span> <span class="n">start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
                        <span class="n">t</span><span class="p">,</span>
                        <span class="n">xp</span><span class="p">,</span>
                        <span class="n">fp</span><span class="p">,</span>
                        <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span>
                        <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">interpolated_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
                            <span class="n">t</span><span class="p">,</span>
                            <span class="n">xp</span><span class="p">,</span>
                            <span class="n">row</span><span class="p">,</span>
                            <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span>
                            <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="mi">0</span><span class="p">,</span>
                        <span class="n">fp</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">new_d</span><span class="p">[</span><span class="n">start</span> <span class="p">:</span> <span class="n">start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">interpolated_values</span>

            <span class="n">start</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_initialize_tsd_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_d</span><span class="p">,</span> <span class="n">time_index</span><span class="o">=</span><span class="n">new_t</span><span class="p">,</span> <span class="n">time_support</span><span class="o">=</span><span class="n">ep</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">derivative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ep</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes the derivative of the time series with respect to time. Wraps numpy.gradient.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ep : IntervalSet, optional</span>
<span class="sd">            The epochs to calculate derivatives. If None, the time support of Tsd is used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Tsd, TsdFrame or TsdTensor</span>
<span class="sd">            The derivative of the time series.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; tsd = nap.Tsd(t=np.arange(5), d=np.arange(0, 10, 2))</span>
<span class="sd">        &gt;&gt;&gt; tsd_derivative = tsd.derivative()</span>
<span class="sd">        &gt;&gt;&gt; tsd_derivative</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  --</span>
<span class="sd">        0            2</span>
<span class="sd">        1            2</span>
<span class="sd">        2            2</span>
<span class="sd">        3            2</span>
<span class="sd">        4            2</span>
<span class="sd">        dtype: float64, shape: (5,)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_support</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ep</span><span class="p">,</span> <span class="n">IntervalSet</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;ep should be an object of type IntervalSet&quot;</span><span class="p">)</span>

        <span class="n">new_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">(</span><span class="n">ep</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>

        <span class="n">new_shape</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">new_t</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_t</span><span class="p">),)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="p">)</span>
        <span class="n">new_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">new_shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ep</span><span class="p">)):</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ep</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ep</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">new_d</span><span class="p">[</span><span class="n">start</span> <span class="p">:</span> <span class="n">start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span>
                        <span class="n">tmp</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">tmp</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Compute gradient along first axis (time)</span>
                    <span class="n">new_d</span><span class="p">[</span><span class="n">start</span> <span class="p">:</span> <span class="n">start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span>
                        <span class="n">tmp</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">tmp</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
                    <span class="p">)</span>

            <span class="n">start</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_initialize_tsd_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_d</span><span class="p">,</span> <span class="n">time_index</span><span class="o">=</span><span class="n">new_t</span><span class="p">,</span> <span class="n">time_support</span><span class="o">=</span><span class="n">ep</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_trial_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="n">padding_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return trial-based tensor from an IntervalSet object. The shape of the tensor array is</span>
<span class="sd">        (shape of time series, number of trials, number of  time points)</span>

<span class="sd">        The `align` parameter controls how the time series are aligned. If `align=&quot;start&quot;`, the time</span>
<span class="sd">        series are aligned to the start of each trial. If `align=&quot;end&quot;`, the time series are aligned</span>
<span class="sd">        to the end of each trial.</span>

<span class="sd">        If trials have uneven durations, the returned array is padded. The parameter `padding_value`</span>
<span class="sd">        determine which value is used to pad the array. Default is NaN.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ep : IntervalSet</span>
<span class="sd">            Epochs holding the trials. Each interval can be of unequal size.</span>
<span class="sd">        align: str, optional</span>
<span class="sd">            How to align the time series (&#39;start&#39; [default], &#39;end&#39;)</span>
<span class="sd">        padding_value: Number, optional</span>
<span class="sd">            How to pad the array if unequal intervals. Default is np.nan.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.ndarray</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; tsdframe = nap.TsdFrame(t=np.arange(100), d=np.arange(200).reshape(2,100).T)</span>
<span class="sd">        &gt;&gt;&gt; ep = nap.IntervalSet(start=np.arange(20, 100, 20), end=np.arange(20, 100, 20) + np.arange(2, 10, 2))</span>
<span class="sd">        &gt;&gt;&gt; print(ep)</span>
<span class="sd">          index    start    end</span>
<span class="sd">              0       20     22</span>
<span class="sd">              1       40     44</span>
<span class="sd">              2       60     66</span>
<span class="sd">              3       80     88</span>
<span class="sd">        shape: (4, 2), time unit: sec.</span>

<span class="sd">        Create a trial-based tensor by slicing `tsdframe` for each interval of `ep`.</span>

<span class="sd">        &gt;&gt;&gt; tensor = tsdframe.to_trial_tensor(ep)</span>
<span class="sd">        &gt;&gt;&gt; tensor</span>
<span class="sd">        array([[[ 20.,  21.,  22.,  nan,  nan,  nan,  nan,  nan,  nan],</span>
<span class="sd">                [ 40.,  41.,  42.,  43.,  44.,  nan,  nan,  nan,  nan],</span>
<span class="sd">                [ 60.,  61.,  62.,  63.,  64.,  65.,  66.,  nan,  nan],</span>
<span class="sd">                [ 80.,  81.,  82.,  83.,  84.,  85.,  86.,  87.,  88.]],</span>
<span class="sd">               [[120., 121., 122.,  nan,  nan,  nan,  nan,  nan,  nan],</span>
<span class="sd">                [140., 141., 142., 143., 144.,  nan,  nan,  nan,  nan],</span>
<span class="sd">                [160., 161., 162., 163., 164., 165., 166.,  nan,  nan],</span>
<span class="sd">                [180., 181., 182., 183., 184., 185., 186., 187., 188.]]])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ep</span><span class="p">,</span> <span class="n">IntervalSet</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Argument ep should be of type IntervalSet&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">align</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;align should be &#39;start&#39; or &#39;end&#39;&quot;</span><span class="p">)</span>

        <span class="n">slices</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_slice</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">ep</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">sl</span><span class="p">:</span> <span class="n">sl</span><span class="o">.</span><span class="n">stop</span> <span class="o">-</span> <span class="n">sl</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">slices</span><span class="p">))</span>
        <span class="n">n_t</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ep</span><span class="p">),</span> <span class="n">n_t</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span> <span class="o">*</span> <span class="n">padding_value</span>
        <span class="k">if</span> <span class="n">align</span> <span class="o">==</span> <span class="s2">&quot;start&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">slices</span><span class="p">):</span>
                <span class="n">output</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span> <span class="p">:</span> <span class="n">lengths</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">sl</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">align</span> <span class="o">==</span> <span class="s2">&quot;end&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">slices</span><span class="p">):</span>
                <span class="n">output</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">n_t</span> <span class="o">-</span> <span class="n">lengths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">sl</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">destination</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">output</span>


<div class="viewcode-block" id="TsdTensor">
<a class="viewcode-back" href="../../../generated/pynapple.TsdTensor.html#pynapple.TsdTensor">[docs]</a>
<span class="k">class</span> <span class="nc">TsdTensor</span><span class="p">(</span><span class="n">_BaseTsd</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Container for neurophysiological time series with more than 2 dimensions (for example movies).</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    rate : float</span>
<span class="sd">        Frequency of the time series (Hz) computed over the time support</span>
<span class="sd">    time_support : IntervalSet</span>
<span class="sd">        The time support of the time series</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Initialize a TsdTensor:</span>

<span class="sd">    &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; t = np.arange(10)</span>
<span class="sd">    &gt;&gt;&gt; d = np.random.randn(10, 2, 3)</span>
<span class="sd">    &gt;&gt;&gt; tsdtensor = nap.TsdTensor(t=t, d=d)</span>
<span class="sd">    &gt;&gt;&gt; tsdtensor</span>
<span class="sd">    Time (s)</span>
<span class="sd">    ----------  -------------------------------</span>
<span class="sd">    0           [[-1.493178 ... -1.281017] ...]</span>
<span class="sd">    1           [[0.230829 ... 0.437679] ...]</span>
<span class="sd">    2           [[-0.462031 ...  0.344506] ...]</span>
<span class="sd">    3           [[0.497019 ... 0.469494] ...]</span>
<span class="sd">    4           [[0.065921 ... 1.012917] ...]</span>
<span class="sd">    5           [[0.158534 ... 1.455523] ...]</span>
<span class="sd">    6           [[-2.567728 ...  0.61182 ] ...]</span>
<span class="sd">    7           [[0.940799 ... 0.109203] ...]</span>
<span class="sd">    8           [[2.340077 ... 0.21885 ] ...]</span>
<span class="sd">    9           [[-0.306175 ... -0.447414] ...]</span>
<span class="sd">    dtype: float64, shape: (10, 2, 3)</span>

<span class="sd">    Initialize a TsdTensor with `time_support`:</span>

<span class="sd">    &gt;&gt;&gt; t = np.arange(10)</span>
<span class="sd">    &gt;&gt;&gt; d = np.random.randn(10, 2, 3)</span>
<span class="sd">    &gt;&gt;&gt; time_support = nap.IntervalSet(start=0, end=4)</span>
<span class="sd">    &gt;&gt;&gt; tsdtensor = nap.TsdTensor(t=t, d=d, time_support=time_support)</span>
<span class="sd">    &gt;&gt;&gt; tsdtensor</span>
<span class="sd">    Time (s)</span>
<span class="sd">    ----------  -------------------------------</span>
<span class="sd">    0           [[-1.493178 ... -1.281017] ...]</span>
<span class="sd">    1           [[0.230829 ... 0.437679] ...]</span>
<span class="sd">    2           [[-0.462031 ...  0.344506] ...]</span>
<span class="sd">    3           [[0.497019 ... 0.469494] ...]</span>
<span class="sd">    4           [[0.065921 ... 1.012917] ...]</span>
<span class="sd">    dtype: float64, shape: (5, 2, 3)</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TsdTensor.__init__">
<a class="viewcode-back" href="../../../generated/pynapple.TsdTensor.__init__.html#pynapple.TsdTensor.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">time_units</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">time_support</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">load_array</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TsdTensor initializer</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        t : numpy.ndarray</span>
<span class="sd">            the time index t</span>
<span class="sd">        d : numpy.ndarray</span>
<span class="sd">            The data</span>
<span class="sd">        time_units : str, optional</span>
<span class="sd">            The time units in which times are specified (&#39;us&#39;, &#39;ms&#39;, &#39;s&#39; [default]).</span>
<span class="sd">        time_support : IntervalSet, optional</span>
<span class="sd">            The time support of the TsdFrame object</span>
<span class="sd">        load_array : bool, optional</span>
<span class="sd">            Whether the data should be converted to a numpy (or jax) array. Useful when passing a memory map object like zarr.</span>
<span class="sd">            Default is True. Does not apply if `d` is already a numpy array  or a numpy memory map.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">time_units</span><span class="p">,</span> <span class="n">time_support</span><span class="p">,</span> <span class="n">load_array</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Data should have more than 2 dimensions. If ndim &lt; 3, use TsdFrame or Tsd object&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nap_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">True</span></div>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
        <span class="n">bottom</span> <span class="o">=</span> <span class="s2">&quot;dtype: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, shape: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">max_rows</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">_get_terminal_size</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">max_rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

            <span class="k">def</span> <span class="nf">create_str</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array2string</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]),</span>
                            <span class="n">precision</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                            <span class="n">separator</span><span class="o">=</span><span class="s2">&quot; ... &quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array2string</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s2">&quot;[&quot;</span> <span class="o">+</span> <span class="n">create_str</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; ...]&quot;</span>

            <span class="n">_str_</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_rows</span><span class="p">:</span>
                <span class="n">n_rows</span> <span class="o">=</span> <span class="n">max_rows</span> <span class="o">//</span> <span class="mi">2</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">array</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n_rows</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n_rows</span><span class="p">]):</span>
                    <span class="n">_str_</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">create_str</span><span class="p">(</span><span class="n">array</span><span class="p">)])</span>
                <span class="n">_str_</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">array</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="n">n_rows</span><span class="p">:],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">n_rows</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                <span class="p">):</span>
                    <span class="n">_str_</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">create_str</span><span class="p">(</span><span class="n">array</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">array</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                    <span class="n">_str_</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">create_str</span><span class="p">(</span><span class="n">array</span><span class="p">)])</span>

            <span class="k">return</span> <span class="n">tabulate</span><span class="p">(</span><span class="n">_str_</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">colalign</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">bottom</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tabulate</span><span class="p">([],</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">bottom</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">Tsd</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;When indexing with a Tsd, it must contain boolean values&quot;</span>
                <span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">Tsd</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;When indexing with a Tsd, it must contain boolean values&quot;</span>
                <span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">values</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">Tsd</span><span class="p">)</span> <span class="k">else</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">index</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">_initialize_tsd_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">time_index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>

<div class="viewcode-block" id="TsdTensor.get_slice">
<a class="viewcode-back" href="../../../generated/pynapple.TsdTensor.get_slice.html#pynapple.TsdTensor.get_slice">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;get_slice&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_unit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; tsdtensor = nap.TsdTensor(t = [0, 1, 2, 3], d = np.random.randn(4, 3, 3))</span>

<span class="sd">        Slice over a range:</span>

<span class="sd">        &gt;&gt;&gt; tsdtensor.get_slice(1.2, 2.6)</span>
<span class="sd">        slice(np.int64(2), np.int64(3), None)</span>
<span class="sd">        &gt;&gt;&gt; tsdtensor.get_slice(1.0, 2.0)</span>
<span class="sd">        slice(np.int64(1), np.int64(3), None)</span>

<span class="sd">        Slice a single value:</span>

<span class="sd">        &gt;&gt;&gt; tsdtensor.get_slice(1.2)</span>
<span class="sd">        slice(np.int64(1), np.int64(2), None)</span>
<span class="sd">        &gt;&gt;&gt; tsdtensor.get_slice(2.0)</span>
<span class="sd">        slice(np.int64(2), np.int64(3), None)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">get_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">time_unit</span><span class="p">)</span></div>


<div class="viewcode-block" id="TsdTensor.count">
<a class="viewcode-back" href="../../../generated/pynapple.TsdTensor.count.html#pynapple.TsdTensor.count">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bin_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_units</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        This example shows how to count timestamps within bins of 0.1 second.</span>

<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np; np.random.seed(42)</span>
<span class="sd">        &gt;&gt;&gt; t = np.unique(np.sort(np.random.randint(0, 1000, 100)))</span>
<span class="sd">        &gt;&gt;&gt; tsdtensor = nap.TsdTensor(t=t, d=np.random.randn(len(t), 4, 4), time_units=&#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tsdtensor</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  -------------------------------</span>
<span class="sd">        1.0         [[-2.178334 ...  0.324199] ...]</span>
<span class="sd">        13.0        [[-1.875677 ... -0.906721] ...]</span>
<span class="sd">        20.0        [[0.326845 ... 0.736122] ...]</span>
<span class="sd">        21.0        [[1.62292 ... 0.89663] ...]</span>
<span class="sd">        34.0        [[-0.870305 ...  2.943663] ...]</span>
<span class="sd">        58.0        [[-0.441766 ... -1.426479] ...]</span>
<span class="sd">        ...</span>
<span class="sd">        897.0       [[ 0.962199 ... -0.370506] ...]</span>
<span class="sd">        931.0       [[-0.511451 ...  0.5125  ] ...]</span>
<span class="sd">        942.0       [[-0.828463 ...  0.300192] ...]</span>
<span class="sd">        955.0       [[-1.193155 ...  0.247027] ...]</span>
<span class="sd">        957.0       [[1.638941 ... 0.236425] ...]</span>
<span class="sd">        975.0       [[ 0.393912 ... -1.180782] ...]</span>
<span class="sd">        dtype: float64, shape: (94, 4, 4)</span>

<span class="sd">        tsdtensor is a timestamp tensor with data.</span>

<span class="sd">        &gt;&gt;&gt; ep = nap.IntervalSet(start = 0, end = 500, time_units = &#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ep</span>
<span class="sd">          index    start    end</span>
<span class="sd">              0        0    500</span>
<span class="sd">        shape: (1, 2), time unit: sec.</span>

<span class="sd">        ep is an IntervalSet object defining the epochs.</span>

<span class="sd">        &gt;&gt;&gt; bincount = tsdtensor.count(10.0, ep=ep)</span>
<span class="sd">        &gt;&gt;&gt; bincount</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  --</span>
<span class="sd">        5.0          1</span>
<span class="sd">        15.0         1</span>
<span class="sd">        25.0         2</span>
<span class="sd">        35.0         1</span>
<span class="sd">        45.0         0</span>
<span class="sd">        55.0         1</span>
<span class="sd">        ...</span>
<span class="sd">        445.0        0</span>
<span class="sd">        455.0        3</span>
<span class="sd">        465.0        1</span>
<span class="sd">        475.0        3</span>
<span class="sd">        485.0        1</span>
<span class="sd">        495.0        1</span>
<span class="sd">        dtype: int64, shape: (50,)</span>
<span class="sd">        &gt;&gt;&gt; bincount.time_support</span>
<span class="sd">          index    start    end</span>
<span class="sd">              0        0    500</span>
<span class="sd">        shape: (1, 2), time unit: sec.</span>

<span class="sd">        bincount automatically inherits ep as time support.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bin_size</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="n">time_units</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span></div>


<div class="viewcode-block" id="TsdTensor.restrict">
<a class="viewcode-back" href="../../../generated/pynapple.TsdTensor.restrict.html#pynapple.TsdTensor.restrict">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;restrict&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">restrict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iset</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np; np.random.seed(42)</span>
<span class="sd">        &gt;&gt;&gt; t = np.unique(np.sort(np.random.randint(0, 1000, 100)))</span>
<span class="sd">        &gt;&gt;&gt; tsdtensor_before = nap.TsdTensor(t=t, d=np.random.randn(len(t), 4, 4), time_units=&#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tsdtensor_before</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  -------------------------------</span>
<span class="sd">        1.0         [[-2.178334 ...  0.324199] ...]</span>
<span class="sd">        13.0        [[-1.875677 ... -0.906721] ...]</span>
<span class="sd">        20.0        [[0.326845 ... 0.736122] ...]</span>
<span class="sd">        21.0        [[1.62292 ... 0.89663] ...]</span>
<span class="sd">        34.0        [[-0.870305 ...  2.943663] ...]</span>
<span class="sd">        58.0        [[-0.441766 ... -1.426479] ...]</span>
<span class="sd">        ...</span>
<span class="sd">        897.0       [[ 0.962199 ... -0.370506] ...]</span>
<span class="sd">        931.0       [[-0.511451 ...  0.5125  ] ...]</span>
<span class="sd">        942.0       [[-0.828463 ...  0.300192] ...]</span>
<span class="sd">        955.0       [[-1.193155 ...  0.247027] ...]</span>
<span class="sd">        957.0       [[1.638941 ... 0.236425] ...]</span>
<span class="sd">        975.0       [[ 0.393912 ... -1.180782] ...]</span>
<span class="sd">        dtype: float64, shape: (94, 4, 4)</span>

<span class="sd">        tsdtensor_before is a timestamp tensor with data.</span>

<span class="sd">        &gt;&gt;&gt; ep = nap.IntervalSet(start = 0, end = 500, time_units = &#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ep</span>
<span class="sd">          index    start    end</span>
<span class="sd">              0        0    500</span>
<span class="sd">        shape: (1, 2), time unit: sec.</span>

<span class="sd">        ep is an IntervalSet object defining the epochs.</span>

<span class="sd">        &gt;&gt;&gt; tsdtensor_after = tsdtensor_before.restrict(ep)</span>
<span class="sd">        &gt;&gt;&gt; tsdtensor_after</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  -------------------------------</span>
<span class="sd">        1.0         [[-2.178334 ...  0.324199] ...]</span>
<span class="sd">        13.0        [[-1.875677 ... -0.906721] ...]</span>
<span class="sd">        20.0        [[0.326845 ... 0.736122] ...]</span>
<span class="sd">        21.0        [[1.62292 ... 0.89663] ...]</span>
<span class="sd">        34.0        [[-0.870305 ...  2.943663] ...]</span>
<span class="sd">        58.0        [[-0.441766 ... -1.426479] ...]</span>
<span class="sd">        ...</span>
<span class="sd">        466.0       [[-1.045913 ...  1.601238] ...]</span>
<span class="sd">        474.0       [[ 1.354845 ... -0.382483] ...]</span>
<span class="sd">        475.0       [[ 1.347856 ... -2.011918] ...]</span>
<span class="sd">        476.0       [[-0.218104 ... -0.019882] ...]</span>
<span class="sd">        484.0       [[0.454563 ... 0.636631] ...]</span>
<span class="sd">        491.0       [[ 0.618141 ... -0.10405 ] ...]</span>
<span class="sd">        dtype: float64, shape: (53, 4, 4)</span>

<span class="sd">        tsdtensor_after is a timestamp tensor restricted to the epochs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">restrict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iset</span><span class="p">)</span></div>


<div class="viewcode-block" id="TsdTensor.in_interval">
<a class="viewcode-back" href="../../../generated/pynapple.TsdTensor.in_interval.html#pynapple.TsdTensor.in_interval">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;in_interval&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">in_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iset</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; t = np.arange(100)</span>
<span class="sd">        &gt;&gt;&gt; ep = nap.IntervalSet(start=0, end=50)</span>
<span class="sd">        &gt;&gt;&gt; tsdtensor = nap.TsdTensor(t=t, d=np.random.randn(len(t), 4, 4))</span>
<span class="sd">        &gt;&gt;&gt; tsdtensor.in_interval(ep)</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  --</span>
<span class="sd">        0.0          1</span>
<span class="sd">        1.0          1</span>
<span class="sd">        2.0          1</span>
<span class="sd">        3.0          1</span>
<span class="sd">        4.0          1</span>
<span class="sd">        5.0          1</span>
<span class="sd">        6.0          1</span>
<span class="sd">        ...</span>
<span class="sd">        93.0         0</span>
<span class="sd">        94.0         0</span>
<span class="sd">        95.0         0</span>
<span class="sd">        96.0         0</span>
<span class="sd">        97.0         0</span>
<span class="sd">        98.0         0</span>
<span class="sd">        99.0         0</span>
<span class="sd">        dtype: bool, shape: (100,)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iset</span><span class="p">)</span></div>


<div class="viewcode-block" id="TsdTensor.value_from">
<a class="viewcode-back" href="../../../generated/pynapple.TsdTensor.value_from.html#pynapple.TsdTensor.value_from">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;value_from&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">value_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        In this example, the tsdtensor object will receive the closest values in time from a tsd.</span>

<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np; np.random.seed(42)</span>
<span class="sd">        &gt;&gt;&gt; t = np.unique(np.sort(np.random.randint(0, 1000, 100))) # random times</span>
<span class="sd">        &gt;&gt;&gt; tsdtensor = nap.TsdTensor(t=t, d=np.random.randn(len(t), 3, 3), time_units=&#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tsdtensor</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  -------------------------------</span>
<span class="sd">        1.0         [[-2.178334 ...  0.172694] ...]</span>
<span class="sd">        13.0        [[0.659191 ... 1.070985] ...]</span>
<span class="sd">        20.0        [[0.636305 ... 0.476043] ...]</span>
<span class="sd">        21.0        [[-1.123898 ...  1.726516] ...]</span>
<span class="sd">        34.0        [[-0.779702 ... -0.150534] ...]</span>
<span class="sd">        58.0        [[0.423943 ... 2.287226] ...]</span>
<span class="sd">        ...</span>
<span class="sd">        897.0       [[1.444173 ... 0.175421] ...]</span>
<span class="sd">        931.0       [[ 0.995858 ... -0.019882] ...]</span>
<span class="sd">        942.0       [[-0.80603  ...  0.286974] ...]</span>
<span class="sd">        955.0       [[ 0.636631 ... -0.883157] ...]</span>
<span class="sd">        957.0       [[-0.0971   ...  1.138171] ...]</span>
<span class="sd">        975.0       [[ 1.194182 ... -1.499837] ...]</span>
<span class="sd">        dtype: float64, shape: (94, 3, 3)</span>

<span class="sd">        tsdtensor is a timestamp tensor with values.</span>

<span class="sd">        &gt;&gt;&gt; tsd_from = nap.Tsd(t=np.arange(0,1000), d=np.random.choice([1,2,3], 1000), time_units=&#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tsd_from</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  --</span>
<span class="sd">        0.0          3</span>
<span class="sd">        1.0          3</span>
<span class="sd">        2.0          2</span>
<span class="sd">        3.0          1</span>
<span class="sd">        4.0          1</span>
<span class="sd">        5.0          3</span>
<span class="sd">        6.0          1</span>
<span class="sd">        ...</span>
<span class="sd">        993.0        1</span>
<span class="sd">        994.0        1</span>
<span class="sd">        995.0        1</span>
<span class="sd">        996.0        1</span>
<span class="sd">        997.0        2</span>
<span class="sd">        998.0        1</span>
<span class="sd">        999.0        1</span>
<span class="sd">        dtype: int64, shape: (1000,)</span>

<span class="sd">        tsd_from contains other values.</span>

<span class="sd">        &gt;&gt;&gt; ep = nap.IntervalSet(start = 0, end = 500, time_units = &#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ep</span>
<span class="sd">          index    start    end</span>
<span class="sd">              0        0    500</span>
<span class="sd">        shape: (1, 2), time unit: sec.</span>

<span class="sd">        An epoch can be passed to restrict the operation.</span>

<span class="sd">        &gt;&gt;&gt; tsd_after = tsdtensor.value_from(tsd_from, ep, mode=&#39;closest&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tsd_after</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  --</span>
<span class="sd">        1.0          3</span>
<span class="sd">        13.0         3</span>
<span class="sd">        20.0         2</span>
<span class="sd">        21.0         1</span>
<span class="sd">        34.0         2</span>
<span class="sd">        58.0         1</span>
<span class="sd">        71.0         2</span>
<span class="sd">        ...</span>
<span class="sd">        459.0        1</span>
<span class="sd">        466.0        3</span>
<span class="sd">        474.0        3</span>
<span class="sd">        475.0        3</span>
<span class="sd">        476.0        3</span>
<span class="sd">        484.0        2</span>
<span class="sd">        491.0        2</span>
<span class="sd">        dtype: int64, shape: (53,)</span>

<span class="sd">        tsd_after is the same length as tsdtensor restricted to ep.</span>

<span class="sd">        &gt;&gt;&gt; print(len(tsdtensor.restrict(ep)), len(tsd_after))</span>
<span class="sd">        53 53</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">value_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span></div>


<div class="viewcode-block" id="TsdTensor.time_diff">
<a class="viewcode-back" href="../../../generated/pynapple.TsdTensor.time_diff.html#pynapple.TsdTensor.time_diff">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;time_diff&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">time_diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; tsdtensor = nap.TsdTensor(t=[1, 3, 5, 6, 8, 12], d=np.ones((6,6,6)))</span>
<span class="sd">        &gt;&gt;&gt; epochs = nap.IntervalSet(start=2, end=9, time_units=&#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tsd_time_diffs = tsdtensor.time_diff(align=&quot;center&quot;, epochs=epochs)</span>
<span class="sd">        &gt;&gt;&gt; tsd_time_diffs</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  --</span>
<span class="sd">        4            2</span>
<span class="sd">        5.5          1</span>
<span class="sd">        7            2</span>
<span class="sd">        dtype: float64, shape: (3,)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">time_diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">align</span><span class="p">,</span> <span class="n">epochs</span><span class="p">)</span></div>


<div class="viewcode-block" id="TsdTensor.save">
<a class="viewcode-back" href="../../../generated/pynapple.TsdTensor.save.html#pynapple.TsdTensor.save">[docs]</a>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save TsdTensor object in npz format. The file will contain the timestamps, the</span>
<span class="sd">        data and the time support.</span>

<span class="sd">        The main purpose of this function is to save small/medium sized time series</span>
<span class="sd">        objects. For example, you extracted several channels from your recording and</span>
<span class="sd">        filtered them. You can save the filtered channels as a npz to avoid</span>
<span class="sd">        reprocessing it.</span>

<span class="sd">        You can load the object with `nap.load_file`. Keys are &#39;t&#39;, &#39;d&#39;, &#39;start&#39;, &#39;end&#39;, &#39;type&#39;</span>
<span class="sd">        and &#39;columns&#39; for columns names.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            The filename</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; tsdtensor = nap.TsdTensor(t=np.array([0., 1.]), d = np.zeros((2,3,4)))</span>
<span class="sd">        &gt;&gt;&gt; tsdtensor.save(&quot;my_path/my_tsdtensor.npz&quot;)</span>

<span class="sd">        To load you file, you can use the `nap.load_file` function :</span>

<span class="sd">        &gt;&gt;&gt; tsdtensor = nap.load_file(&quot;my_path/my_tsdtensor.npz&quot;)</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If filename is not str, path does not exist or filename is a directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_support</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
            <span class="n">end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_support</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nap_class</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str_</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span></div>
</div>



<div class="viewcode-block" id="TsdFrame">
<a class="viewcode-back" href="../../../generated/pynapple.TsdFrame.html#pynapple.TsdFrame">[docs]</a>
<span class="k">class</span> <span class="nc">TsdFrame</span><span class="p">(</span><span class="n">_BaseTsd</span><span class="p">,</span> <span class="n">_MetadataMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Column-based container for neurophysiological time series.</span>
<span class="sd">    A pandas.DataFrame can be passed directly.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t : numpy.ndarray or pandas.DataFrame</span>
<span class="sd">        the time index t,  or a pandas.DataFrame (if d is None)</span>
<span class="sd">    d : numpy.ndarray</span>
<span class="sd">        The data</span>
<span class="sd">    time_units : str, optional</span>
<span class="sd">        The time units in which times are specified (&#39;us&#39;, &#39;ms&#39;, &#39;s&#39; [default]).</span>
<span class="sd">    time_support : IntervalSet, optional</span>
<span class="sd">        The time support of the TsdFrame object</span>
<span class="sd">    columns : iterables</span>
<span class="sd">        Column names</span>
<span class="sd">    load_array : bool, optional</span>
<span class="sd">        Whether the data should be converted to a numpy (or jax) array. Useful when passing a memory map object like zarr.</span>
<span class="sd">        Default is True. Does not apply if `d` is already a numpy array or a numpy memory map.</span>
<span class="sd">    metadata: pd.DataFrame or dict, optional</span>
<span class="sd">        Metadata associated with data columns. Metadata names are pulled from DataFrame columns or dictionary keys.</span>
<span class="sd">        The length of the metadata should match the number of data columns.</span>
<span class="sd">        If a DataFrame is passed, the index should match the columns of the TsdFrame.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Initialize a TsdFrame:</span>

<span class="sd">    &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; t = np.arange(100)</span>
<span class="sd">    &gt;&gt;&gt; d = np.ones((100, 3))</span>
<span class="sd">    &gt;&gt;&gt; tsdframe = nap.TsdFrame(t=t, d=d)</span>
<span class="sd">    &gt;&gt;&gt; tsdframe</span>
<span class="sd">    Time (s)    0    1    2</span>
<span class="sd">    ----------  ---  ---  ---</span>
<span class="sd">    0.0         1.0  1.0  1.0</span>
<span class="sd">    1.0         1.0  1.0  1.0</span>
<span class="sd">    2.0         1.0  1.0  1.0</span>
<span class="sd">    3.0         1.0  1.0  1.0</span>
<span class="sd">    4.0         1.0  1.0  1.0</span>
<span class="sd">    ...         ...  ...  ...</span>
<span class="sd">    95.0        1.0  1.0  1.0</span>
<span class="sd">    96.0        1.0  1.0  1.0</span>
<span class="sd">    97.0        1.0  1.0  1.0</span>
<span class="sd">    98.0        1.0  1.0  1.0</span>
<span class="sd">    99.0        1.0  1.0  1.0</span>
<span class="sd">    dtype: float64, shape: (100, 3)</span>

<span class="sd">    Initialize a TsdFrame with column names:</span>

<span class="sd">    &gt;&gt;&gt; tsdframe = nap.TsdFrame(t=t, d=d, columns=[&#39;A&#39;, &#39;B&#39;, &#39;C&#39;])</span>
<span class="sd">    &gt;&gt;&gt; tsdframe</span>
<span class="sd">    Time (s)    A    B    C</span>
<span class="sd">    ----------  ---  ---  ---</span>
<span class="sd">    0.0         1.0  1.0  1.0</span>
<span class="sd">    1.0         1.0  1.0  1.0</span>
<span class="sd">    2.0         1.0  1.0  1.0</span>
<span class="sd">    3.0         1.0  1.0  1.0</span>
<span class="sd">    4.0         1.0  1.0  1.0</span>
<span class="sd">    ...         ...  ...  ...</span>
<span class="sd">    95.0        1.0  1.0  1.0</span>
<span class="sd">    96.0        1.0  1.0  1.0</span>
<span class="sd">    97.0        1.0  1.0  1.0</span>
<span class="sd">    98.0        1.0  1.0  1.0</span>
<span class="sd">    99.0        1.0  1.0  1.0</span>
<span class="sd">    dtype: float64, shape: (100, 3)</span>

<span class="sd">    Initialize a TsdFrame with metadata:</span>

<span class="sd">    &gt;&gt;&gt; metadata = {&quot;color&quot;: [&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;], &quot;depth&quot;: [1, 2, 3]}</span>
<span class="sd">    &gt;&gt;&gt; tsdframe = nap.TsdFrame(t=t, d=d, columns=[&quot;A&quot;, &quot;B&quot;, &quot;C&quot;], metadata=metadata)</span>
<span class="sd">    &gt;&gt;&gt; tsdframe</span>
<span class="sd">    Time (s)    A         B         C</span>
<span class="sd">    ----------  --------  --------  --------</span>
<span class="sd">    0.0         1.0       1.0       1.0</span>
<span class="sd">    1.0         1.0       1.0       1.0</span>
<span class="sd">    2.0         1.0       1.0       1.0</span>
<span class="sd">    3.0         1.0       1.0       1.0</span>
<span class="sd">    4.0         1.0       1.0       1.0</span>
<span class="sd">    ...         ...       ...       ...</span>
<span class="sd">    95.0        1.0       1.0       1.0</span>
<span class="sd">    96.0        1.0       1.0       1.0</span>
<span class="sd">    97.0        1.0       1.0       1.0</span>
<span class="sd">    98.0        1.0       1.0       1.0</span>
<span class="sd">    99.0        1.0       1.0       1.0</span>
<span class="sd">    Metadata</span>
<span class="sd">    --------    --------  --------  --------</span>
<span class="sd">    color       red       blue      green</span>
<span class="sd">    depth       1         2         3</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    dtype: float64, shape: (100, 3)</span>

<span class="sd">    Initialize a TsdFrame with a pandas DataFrame:</span>

<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; data = pd.DataFrame(index=t, columns=[&quot;A&quot;, &quot;B&quot;, &quot;C&quot;], data=d)</span>
<span class="sd">    &gt;&gt;&gt; metadata = pd.DataFrame(</span>
<span class="sd">    ...    index=[&quot;A&quot;, &quot;B&quot;, &quot;C&quot;],</span>
<span class="sd">    ...    columns=[&quot;color&quot;, &quot;depth&quot;],</span>
<span class="sd">    ...    data=[[&quot;red&quot;, 1], [&quot;blue&quot;, 2], [&quot;green&quot;, 3]],</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; tsdframe = nap.TsdFrame(data, metadata=metadata)</span>
<span class="sd">    &gt;&gt;&gt; tsdframe</span>
<span class="sd">    Time (s)    A         B         C</span>
<span class="sd">    ----------  --------  --------  --------</span>
<span class="sd">    0.0         1.0       1.0       1.0</span>
<span class="sd">    1.0         1.0       1.0       1.0</span>
<span class="sd">    2.0         1.0       1.0       1.0</span>
<span class="sd">    3.0         1.0       1.0       1.0</span>
<span class="sd">    4.0         1.0       1.0       1.0</span>
<span class="sd">    ...         ...       ...       ...</span>
<span class="sd">    95.0        1.0       1.0       1.0</span>
<span class="sd">    96.0        1.0       1.0       1.0</span>
<span class="sd">    97.0        1.0       1.0       1.0</span>
<span class="sd">    98.0        1.0       1.0       1.0</span>
<span class="sd">    99.0        1.0       1.0       1.0</span>
<span class="sd">    Metadata</span>
<span class="sd">    --------    --------  --------  --------</span>
<span class="sd">    color       red       blue      green</span>
<span class="sd">    depth       1         2         3</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    dtype: float64, shape: (100, 3)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">columns</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Data column names of the TsdFrame&quot;&quot;&quot;</span>

<div class="viewcode-block" id="TsdFrame.__init__">
<a class="viewcode-back" href="../../../generated/pynapple.TsdFrame.__init__.html#pynapple.TsdFrame.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">t</span><span class="p">,</span>
        <span class="n">d</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">time_units</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
        <span class="n">time_support</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">load_array</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">columns</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">values</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Missing argument d when initializing TsdFrame&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">time_units</span><span class="p">,</span> <span class="n">time_support</span><span class="p">,</span> <span class="n">load_array</span><span class="p">)</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Data should be 1 or 2 dimensional.&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">),</span> <span class="s2">&quot;Number of columns should match the second dimension of d&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nap_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="c1"># initialize metadata for class attributes</span>
        <span class="n">_MetadataMixin</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># to test compatibility with pandas</span>
        <span class="c1"># self._metadata = pd.DataFrame(index=self.metadata_index)</span>
        <span class="c1"># get current list of attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_class_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_class_attributes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;_class_attributes&quot;</span><span class="p">)</span>
        <span class="c1"># set metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_info</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">loc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># add deprecation warning</span>
        <span class="c1"># warnings.warn(</span>
        <span class="c1">#     &quot;&#39;loc&#39; will be deprecated in a future version. Use bracket indexing instead.&quot;,</span>
        <span class="c1">#     DeprecationWarning,</span>
        <span class="c1"># )</span>
        <span class="k">return</span> <span class="n">_TsdFrameSliceHelper</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Start by determining how many columns and rows.</span>
        <span class="c1"># This can be unique for each object</span>
        <span class="n">cols</span><span class="p">,</span> <span class="n">rows</span> <span class="o">=</span> <span class="n">_get_terminal_size</span><span class="p">()</span>
        <span class="n">max_cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">cols</span> <span class="o">//</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">max_rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Computing headers and bottom</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="n">bottom</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;dtype: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">, shape: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_cols</span><span class="p">:</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="n">headers</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">max_cols</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;...&quot;</span><span class="p">]</span>

        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">end</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;...&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_cols</span> <span class="k">else</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_rows</span><span class="p">:</span>
                    <span class="n">n_rows</span> <span class="o">=</span> <span class="n">max_rows</span> <span class="o">//</span> <span class="mi">2</span>
                    <span class="n">ends</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">end</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_rows</span><span class="p">)</span>
                    <span class="n">table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
                        <span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
                                <span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n_rows</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">max_cols</span><span class="p">],</span>
                                    <span class="n">ends</span><span class="p">,</span>
                                <span class="p">),</span>
                                <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">,</span>
                            <span class="p">),</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                                <span class="p">[</span>
                                    <span class="p">[</span><span class="s2">&quot;...&quot;</span><span class="p">]</span>
                                    <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">max_cols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                    <span class="o">+</span> <span class="n">end</span>
                                <span class="p">],</span>
                                <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">,</span>
                            <span class="p">),</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
                                <span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="n">n_rows</span><span class="p">:,</span> <span class="kc">None</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="n">n_rows</span><span class="p">:,</span> <span class="mi">0</span><span class="p">:</span><span class="n">max_cols</span><span class="p">],</span>
                                    <span class="n">ends</span><span class="p">,</span>
                                <span class="p">),</span>
                                <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">,</span>
                            <span class="p">),</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ends</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">end</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                    <span class="n">table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
                        <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="n">max_cols</span><span class="p">],</span>
                            <span class="n">ends</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">end</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Adding metadata if any.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span>
            <span class="n">row_names</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># Necessary for backward compatibility when saving IntervalSet as pickle</span>
            <span class="n">row_names</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">row_names</span><span class="p">):</span>
            <span class="n">n_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">row_names</span><span class="p">)</span>
            <span class="n">max_metarows</span> <span class="o">=</span> <span class="mi">2</span>

            <span class="k">if</span> <span class="n">n_rows</span> <span class="o">&gt;</span> <span class="n">max_metarows</span><span class="p">:</span>
                <span class="n">row_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">row_names</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]))[:,</span> <span class="kc">None</span><span class="p">]</span>
                <span class="n">last_row</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;...&quot;</span><span class="p">]</span>
                <span class="n">n_rows</span> <span class="o">=</span> <span class="n">max_metarows</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">row_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">row_names</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>  <span class="c1"># Vertically</span>
                <span class="n">last_row</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># np.ndarray(shape=(0, table.shape[1]))</span>

            <span class="n">ends</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">end</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_rows</span><span class="p">)</span>

            <span class="n">formatted_metadata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">_convert_iter_to_str</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">end</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                        <span class="n">n_rows</span>
                    <span class="p">)</span>  <span class="c1"># Which correspond to columns in the metadata object</span>
                <span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># Make metadata table</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">row_names</span><span class="p">,</span>
                        <span class="n">formatted_metadata</span><span class="p">,</span>
                        <span class="n">ends</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">mtable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;Metadata&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot; &quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]),</span>
                        <span class="n">tmp</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">last_row</span><span class="p">):</span>
                    <span class="n">mtable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">mtable</span><span class="p">,</span> <span class="n">last_row</span> <span class="o">*</span> <span class="n">mtable</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span>
                    <span class="p">)</span>

            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">mtable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">mtable</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">table</span><span class="p">,</span> <span class="n">mtable</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">tabulate</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">colalign</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">bottom</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tabulate</span><span class="p">([],</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">bottom</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># necessary setter to allow metadata to be set as an attribute</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_attributes</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cannot set attribute: &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is a reserved attribute. Use &#39;set_info()&#39; to set &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; as metadata.&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_MetadataMixin</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="nd">@add_or_convert_metadata</span>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="c1"># TsdFrame needs a custom __getattr__ to override default inherited from BaseTsd</span>

        <span class="c1"># avoid infinite recursion when pickling due to</span>
        <span class="c1"># self._metadata.column having attributes &#39;__reduce__&#39;, &#39;__reduce_ex__&#39;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;__getstate__&quot;</span><span class="p">,</span> <span class="s2">&quot;__setstate__&quot;</span><span class="p">,</span> <span class="s2">&quot;__reduce__&quot;</span><span class="p">,</span> <span class="s2">&quot;__reduce_ex__&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># try:</span>
        <span class="c1">#     metadata = self._metadata</span>
        <span class="c1"># except (AttributeError, RecursionError):</span>
        <span class="c1">#     metadata = {}  # pd.DataFrame(index=self.columns)</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span>

        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;_metadata&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">metadata</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">_MetadataMixin</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">Tsd</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;When indexing with a Tsd, it must contain boolean values&quot;</span>
                <span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">d</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">new_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_indexer</span><span class="p">([</span><span class="n">key</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span>
                        <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">new_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">value</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_MetadataMixin</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;__iter__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key</span><span class="p">]):</span>
                <span class="n">new_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_indexer</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">((</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">new_key</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span>

    <span class="nd">@add_or_convert_metadata</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">values</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s2">&quot;values&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">Tsd</span><span class="p">,</span> <span class="n">TsdFrame</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;When indexing with a Tsd or TsdFrame, it must contain boolean values&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">TsdFrame</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">d</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                    <span class="c1"># ignore deprecated warning for loc</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_MetadataMixin</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;__iter__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key</span><span class="p">]):</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key</span><span class="p">):</span>
                <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                    <span class="c1"># ignore deprecated warning for loc</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_MetadataMixin</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="c1"># if isinstance(index, Number):</span>
            <span class="c1">#     index = np.array([index])</span>

            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">is_array_like</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">output</span><span class="p">]):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                        <span class="ow">and</span> <span class="n">output</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span>
                        <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">))</span>
                    <span class="p">):</span>
                        <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
                    <span class="k">elif</span> <span class="p">(</span>
                        <span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span>
                        <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="p">):</span>
                        <span class="c1"># reshape output of single column if column key is a list or array</span>
                        <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
                <span class="c1"># if getting a row (1 dim implied)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
                    <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>

                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">columns</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">_initialize_tsd_output</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">time_index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">output</span>

<div class="viewcode-block" id="TsdFrame.as_dataframe">
<a class="viewcode-back" href="../../../generated/pynapple.TsdFrame.as_dataframe.html#pynapple.TsdFrame.as_dataframe">[docs]</a>
    <span class="k">def</span> <span class="nf">as_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert the TsdFrame object to a pandas.DataFrame object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out: pandas.DataFrame</span>
<span class="sd">            _</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TsdFrame.as_units">
<a class="viewcode-back" href="../../../generated/pynapple.TsdFrame.as_units.html#pynapple.TsdFrame.as_units">[docs]</a>
    <span class="k">def</span> <span class="nf">as_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a DataFrame with time expressed in the desired unit.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        units : str, optional</span>
<span class="sd">            (&#39;us&#39;, &#39;ms&#39;, &#39;s&#39; [default])</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas.DataFrame</span>
<span class="sd">            the series object with adjusted times</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="n">units</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;us&quot;</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Time (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">units</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="TsdFrame.get_slice">
<a class="viewcode-back" href="../../../generated/pynapple.TsdFrame.get_slice.html#pynapple.TsdFrame.get_slice">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;get_slice&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_unit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; tsdframe = nap.TsdFrame(t = [0, 1, 2, 3], d = np.random.randn(4, 3))</span>

<span class="sd">        Slice over a range:</span>

<span class="sd">        &gt;&gt;&gt; tsdframe.get_slice(1.2, 2.6)</span>
<span class="sd">        slice(np.int64(2), np.int64(3), None)</span>
<span class="sd">        &gt;&gt;&gt; tsdframe.get_slice(1.0, 2.0)</span>
<span class="sd">        slice(np.int64(1), np.int64(3), None)</span>

<span class="sd">        Slice a single value:</span>

<span class="sd">        &gt;&gt;&gt; tsdframe.get_slice(1.2)</span>
<span class="sd">        slice(np.int64(1), np.int64(2), None)</span>
<span class="sd">        &gt;&gt;&gt; tsdframe.get_slice(2.0)</span>
<span class="sd">        slice(np.int64(2), np.int64(3), None)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">get_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">time_unit</span><span class="p">)</span></div>


<div class="viewcode-block" id="TsdFrame.count">
<a class="viewcode-back" href="../../../generated/pynapple.TsdFrame.count.html#pynapple.TsdFrame.count">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bin_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_units</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        This example shows how to count timestamps within bins of 0.1 second.</span>

<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np; np.random.seed(42)</span>
<span class="sd">        &gt;&gt;&gt; t = np.unique(np.sort(np.random.randint(0, 1000, 100)))</span>
<span class="sd">        &gt;&gt;&gt; tsdframe = nap.TsdFrame(t=t, d=np.random.randn(len(t), 4), time_units=&#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tsdframe</span>
<span class="sd">        Time (s)    0         1         2         3</span>
<span class="sd">        ----------  --------  --------  --------  --------</span>
<span class="sd">        1.0         -2.17833  -1.0439   0.17269   0.3242</span>
<span class="sd">        13.0        0.74586   -1.83658  0.56446   0.0255</span>
<span class="sd">        20.0        0.47319   0.65919   2.34075   1.07099</span>
<span class="sd">        21.0        0.09642   0.4191    -0.95303  -1.04787</span>
<span class="sd">        34.0        -1.87568  -1.36678  0.63631   -0.90672</span>
<span class="sd">        58.0        0.47604   1.30366   0.21159   0.59704</span>
<span class="sd">        ...         ...       ...       ...       ...</span>
<span class="sd">        897.0       -0.98723  -0.49116  -1.20912  1.58914</span>
<span class="sd">        931.0       -0.75691  -0.87508  -1.32561  -0.77121</span>
<span class="sd">        942.0       -0.49489  -0.04948  -0.64532  -1.60061</span>
<span class="sd">        955.0       -1.51457  0.67966   -0.12279  0.64889</span>
<span class="sd">        957.0       0.78028   0.15108   -1.23173  0.18958</span>
<span class="sd">        975.0       1.3996    -0.44743  0.34062   -0.01378</span>
<span class="sd">        dtype: float64, shape: (94, 4)</span>

<span class="sd">        tsdframe_before is a timestamp table with data.</span>

<span class="sd">        &gt;&gt;&gt; ep = nap.IntervalSet(start = 0, end = 500, time_units = &#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ep</span>
<span class="sd">          index    start    end</span>
<span class="sd">              0        0    500</span>
<span class="sd">        shape: (1, 2), time unit: sec.</span>

<span class="sd">        ep is an IntervalSet object defining the epochs.</span>

<span class="sd">        &gt;&gt;&gt; bincount = tsdframe.count(10.0, ep=ep)</span>
<span class="sd">        &gt;&gt;&gt; bincount</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  --</span>
<span class="sd">        5.0          1</span>
<span class="sd">        15.0         1</span>
<span class="sd">        25.0         2</span>
<span class="sd">        35.0         1</span>
<span class="sd">        45.0         0</span>
<span class="sd">        55.0         1</span>
<span class="sd">        ...</span>
<span class="sd">        445.0        0</span>
<span class="sd">        455.0        3</span>
<span class="sd">        465.0        1</span>
<span class="sd">        475.0        3</span>
<span class="sd">        485.0        1</span>
<span class="sd">        495.0        1</span>
<span class="sd">        dtype: int64, shape: (50,)</span>
<span class="sd">        &gt;&gt;&gt; bincount.time_support</span>
<span class="sd">          index    start    end</span>
<span class="sd">              0        0    500</span>
<span class="sd">        shape: (1, 2), time unit: sec.</span>

<span class="sd">        bincount automatically inherits ep as time support.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bin_size</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="n">time_units</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span></div>


<div class="viewcode-block" id="TsdFrame.restrict">
<a class="viewcode-back" href="../../../generated/pynapple.TsdFrame.restrict.html#pynapple.TsdFrame.restrict">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;restrict&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">restrict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iset</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np; np.random.seed(42)</span>
<span class="sd">        &gt;&gt;&gt; t = np.unique(np.sort(np.random.randint(0, 1000, 100)))</span>
<span class="sd">        &gt;&gt;&gt; tsdframe_before = nap.TsdFrame(t=t, d=np.random.randn(len(t), 4), time_units=&#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tsdframe_before</span>
<span class="sd">        Time (s)    0         1         2         3</span>
<span class="sd">        ----------  --------  --------  --------  --------</span>
<span class="sd">        1.0         -2.17833  -1.0439   0.17269   0.3242</span>
<span class="sd">        13.0        0.74586   -1.83658  0.56446   0.0255</span>
<span class="sd">        20.0        0.47319   0.65919   2.34075   1.07099</span>
<span class="sd">        21.0        0.09642   0.4191    -0.95303  -1.04787</span>
<span class="sd">        34.0        -1.87568  -1.36678  0.63631   -0.90672</span>
<span class="sd">        58.0        0.47604   1.30366   0.21159   0.59704</span>
<span class="sd">        ...         ...       ...       ...       ...</span>
<span class="sd">        897.0       -0.98723  -0.49116  -1.20912  1.58914</span>
<span class="sd">        931.0       -0.75691  -0.87508  -1.32561  -0.77121</span>
<span class="sd">        942.0       -0.49489  -0.04948  -0.64532  -1.60061</span>
<span class="sd">        955.0       -1.51457  0.67966   -0.12279  0.64889</span>
<span class="sd">        957.0       0.78028   0.15108   -1.23173  0.18958</span>
<span class="sd">        975.0       1.3996    -0.44743  0.34062   -0.01378</span>
<span class="sd">        dtype: float64, shape: (94, 4)</span>

<span class="sd">        tsdframe_before is a timestamp table with data.</span>

<span class="sd">        &gt;&gt;&gt; ep = nap.IntervalSet(start = 0, end = 500, time_units = &#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ep</span>
<span class="sd">          index    start    end</span>
<span class="sd">              0        0    500</span>
<span class="sd">        shape: (1, 2), time unit: sec.</span>

<span class="sd">        ep is an IntervalSet object defining the epochs.</span>

<span class="sd">        &gt;&gt;&gt; tsdframe_after = tsdframe_before.restrict(ep)</span>
<span class="sd">        &gt;&gt;&gt; tsdframe_after</span>
<span class="sd">        Time (s)    0         1         2         3</span>
<span class="sd">        ----------  --------  --------  --------  --------</span>
<span class="sd">        1.0         -2.17833  -1.0439   0.17269   0.3242</span>
<span class="sd">        13.0        0.74586   -1.83658  0.56446   0.0255</span>
<span class="sd">        20.0        0.47319   0.65919   2.34075   1.07099</span>
<span class="sd">        21.0        0.09642   0.4191    -0.95303  -1.04787</span>
<span class="sd">        34.0        -1.87568  -1.36678  0.63631   -0.90672</span>
<span class="sd">        58.0        0.47604   1.30366   0.21159   0.59704</span>
<span class="sd">        ...         ...       ...       ...       ...</span>
<span class="sd">        466.0       -0.16531  -0.68718  0.06835   -0.40941</span>
<span class="sd">        474.0       1.88955   -0.6758   -0.91341  -0.45503</span>
<span class="sd">        475.0       -0.41276  0.59564   -1.99154  0.42603</span>
<span class="sd">        476.0       -0.54129  0.77682   -0.04764  0.51869</span>
<span class="sd">        484.0       -0.3914   0.43802   1.66377   -0.73924</span>
<span class="sd">        491.0       -0.10719  -0.48622  1.59298   -0.43394</span>
<span class="sd">        dtype: float64, shape: (53, 4)</span>

<span class="sd">        tsdframe_after is a timestamp table restricted to the epochs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">restrict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iset</span><span class="p">)</span></div>


<div class="viewcode-block" id="TsdFrame.in_interval">
<a class="viewcode-back" href="../../../generated/pynapple.TsdFrame.in_interval.html#pynapple.TsdFrame.in_interval">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;in_interval&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">in_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iset</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; t = np.arange(100)</span>
<span class="sd">        &gt;&gt;&gt; ep = nap.IntervalSet(start=0, end=50)</span>
<span class="sd">        &gt;&gt;&gt; tsdframe = nap.TsdFrame(t=t, d=np.random.randn(len(t), 4))</span>
<span class="sd">        &gt;&gt;&gt; tsdframe.in_interval(ep)</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  --</span>
<span class="sd">        0.0          1</span>
<span class="sd">        1.0          1</span>
<span class="sd">        2.0          1</span>
<span class="sd">        3.0          1</span>
<span class="sd">        4.0          1</span>
<span class="sd">        5.0          1</span>
<span class="sd">        6.0          1</span>
<span class="sd">        ...</span>
<span class="sd">        93.0         0</span>
<span class="sd">        94.0         0</span>
<span class="sd">        95.0         0</span>
<span class="sd">        96.0         0</span>
<span class="sd">        97.0         0</span>
<span class="sd">        98.0         0</span>
<span class="sd">        99.0         0</span>
<span class="sd">        dtype: bool, shape: (100,)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iset</span><span class="p">)</span></div>


<div class="viewcode-block" id="TsdFrame.value_from">
<a class="viewcode-back" href="../../../generated/pynapple.TsdFrame.value_from.html#pynapple.TsdFrame.value_from">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;value_from&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">value_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        In this example, the tsdframe object will receive the closest values in time from a tsd.</span>

<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np; np.random.seed(42)</span>
<span class="sd">        &gt;&gt;&gt; t = np.unique(np.sort(np.random.randint(0, 1000, 100))) # random times</span>
<span class="sd">        &gt;&gt;&gt; tsdframe = nap.TsdFrame(t=t, d=np.random.randn(len(t), 3), time_units=&#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tsdframe</span>
<span class="sd">        Time (s)    0         1         2</span>
<span class="sd">        ----------  --------  --------  --------</span>
<span class="sd">        1.0         -2.17833  -1.0439   0.17269</span>
<span class="sd">        13.0        0.3242    0.74586   -1.83658</span>
<span class="sd">        20.0        0.56446   0.0255    0.47319</span>
<span class="sd">        21.0        0.65919   2.34075   1.07099</span>
<span class="sd">        34.0        0.09642   0.4191    -0.95303</span>
<span class="sd">        58.0        -1.04787  -1.87568  -1.36678</span>
<span class="sd">        ...         ...       ...       ...</span>
<span class="sd">        897.0       1.95128   -0.04009  0.52944</span>
<span class="sd">        931.0       -0.18389  -0.09008  -0.50588</span>
<span class="sd">        942.0       0.05074   0.4946    1.67831</span>
<span class="sd">        955.0       -1.87447  1.61082   0.52796</span>
<span class="sd">        957.0       -0.36776  -0.54772  1.04368</span>
<span class="sd">        975.0       0.22898   -1.53407  0.36307</span>
<span class="sd">        dtype: float64, shape: (94, 3)</span>

<span class="sd">        tsdframe is a timestamp table with values.</span>

<span class="sd">        &gt;&gt;&gt; tsd_from = nap.Tsd(t=np.arange(0,1000), d=np.random.choice([1,2,3], 1000), time_units=&#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tsd_from</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  --</span>
<span class="sd">        0.0          3</span>
<span class="sd">        1.0          1</span>
<span class="sd">        2.0          3</span>
<span class="sd">        3.0          1</span>
<span class="sd">        4.0          3</span>
<span class="sd">        5.0          1</span>
<span class="sd">        6.0          2</span>
<span class="sd">        ...</span>
<span class="sd">        993.0        1</span>
<span class="sd">        994.0        2</span>
<span class="sd">        995.0        3</span>
<span class="sd">        996.0        1</span>
<span class="sd">        997.0        3</span>
<span class="sd">        998.0        2</span>
<span class="sd">        999.0        3</span>
<span class="sd">        dtype: int64, shape: (1000,)</span>

<span class="sd">        tsd_from contains values, for example the tracking data.</span>

<span class="sd">        &gt;&gt;&gt; ep = nap.IntervalSet(start = 0, end = 500, time_units = &#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ep</span>
<span class="sd">          index    start    end</span>
<span class="sd">              0        0    500</span>
<span class="sd">        shape: (1, 2), time unit: sec.</span>

<span class="sd">        An epoch can be passed to restrict the operation.</span>

<span class="sd">        &gt;&gt;&gt; tsd_after = tsdframe.value_from(tsd_from, ep, mode=&#39;closest&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tsd_after</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  --</span>
<span class="sd">        1.0          1</span>
<span class="sd">        13.0         3</span>
<span class="sd">        20.0         3</span>
<span class="sd">        21.0         2</span>
<span class="sd">        34.0         1</span>
<span class="sd">        58.0         3</span>
<span class="sd">        71.0         3</span>
<span class="sd">        ...</span>
<span class="sd">        459.0        2</span>
<span class="sd">        466.0        2</span>
<span class="sd">        474.0        3</span>
<span class="sd">        475.0        1</span>
<span class="sd">        476.0        2</span>
<span class="sd">        484.0        2</span>
<span class="sd">        491.0        3</span>
<span class="sd">        dtype: int64, shape: (53,)</span>

<span class="sd">        tsd_after is the same length as ts when restricted to ep.</span>

<span class="sd">        &gt;&gt;&gt; print(len(tsdframe.restrict(ep)), len(tsd_after))</span>
<span class="sd">        53 53</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">value_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span></div>


<div class="viewcode-block" id="TsdFrame.time_diff">
<a class="viewcode-back" href="../../../generated/pynapple.TsdFrame.time_diff.html#pynapple.TsdFrame.time_diff">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;time_diff&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">time_diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; tsdframe = nap.TsdFrame(t=[1, 3, 5, 6, 8, 12], d=np.ones((6, 2)))</span>
<span class="sd">        &gt;&gt;&gt; epochs = nap.IntervalSet(start=2, end=9, time_units=&#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tsd_time_diffs = tsdframe.time_diff(align=&quot;center&quot;, epochs=epochs)</span>
<span class="sd">        &gt;&gt;&gt; tsd_time_diffs</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  --</span>
<span class="sd">        4            2</span>
<span class="sd">        5.5          1</span>
<span class="sd">        7            2</span>
<span class="sd">        dtype: float64, shape: (3,)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">time_diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">align</span><span class="p">,</span> <span class="n">epochs</span><span class="p">)</span></div>


    <span class="c1"># @add_or_convert_metadata</span>
<div class="viewcode-block" id="TsdFrame.save">
<a class="viewcode-back" href="../../../generated/pynapple.TsdFrame.save.html#pynapple.TsdFrame.save">[docs]</a>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save TsdFrame object in npz format. The file will contain the timestamps, the</span>
<span class="sd">        data and the time support.</span>

<span class="sd">        The main purpose of this function is to save small/medium sized time series</span>
<span class="sd">        objects. For example, you extracted several channels from your recording and</span>
<span class="sd">        filtered them. You can save the filtered channels as a npz to avoid</span>
<span class="sd">        reprocessing it.</span>

<span class="sd">        You can load the object with `nap.load_file`. Keys are &#39;t&#39;, &#39;d&#39;, &#39;start&#39;, &#39;end&#39;, &#39;type&#39;</span>
<span class="sd">        and &#39;columns&#39; for columns names.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            The filename</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; tsdframe = nap.TsdFrame(t=np.array([0., 1.]), d = np.array([[2, 3],[4,5]]), columns=[&#39;a&#39;, &#39;b&#39;])</span>
<span class="sd">        &gt;&gt;&gt; tsdframe.save(&quot;my_path/my_tsdframe.npz&quot;)</span>

<span class="sd">        To load you file, you can use the `nap.load_file` function :</span>

<span class="sd">        &gt;&gt;&gt; tsdframe = nap.load_file(&quot;my_path/my_tsdframe.npz&quot;)</span>
<span class="sd">        &gt;&gt;&gt; tsdframe</span>
<span class="sd">                  a  b</span>
<span class="sd">        Time (s)</span>
<span class="sd">        0.0       2  3</span>
<span class="sd">        1.0       4  5</span>


<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If filename is not str, path does not exist or filename is a directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="n">cols_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">if</span> <span class="n">cols_name</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">):</span>
            <span class="n">cols_name</span> <span class="o">=</span> <span class="n">cols_name</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[:],</span>
            <span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_support</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
            <span class="n">end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_support</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">cols_name</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;TsdFrame&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str_</span><span class="p">),</span>
            <span class="n">_metadata</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">),</span>  <span class="c1"># save metadata as dictionary</span>
        <span class="p">)</span>

        <span class="k">return</span></div>


<div class="viewcode-block" id="TsdFrame.set_info">
<a class="viewcode-back" href="../../../generated/pynapple.TsdFrame.set_info.html#pynapple.TsdFrame.set_info">[docs]</a>
    <span class="nd">@add_meta_docstring</span><span class="p">(</span><span class="s2">&quot;set_info&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; tsdframe = nap.TsdFrame(t=np.arange(5), d=np.ones((5, 3)), columns=[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;])</span>

<span class="sd">        To add metadata with a pandas.DataFrame:</span>

<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; metadata = pd.DataFrame(index=tsdframe.columns, data=[&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;], columns=[&quot;color&quot;])</span>
<span class="sd">        &gt;&gt;&gt; tsdframe.set_info(metadata)</span>
<span class="sd">        &gt;&gt;&gt; tsdframe</span>
<span class="sd">        Time (s)    a         b         c</span>
<span class="sd">        ----------  --------  --------  --------</span>
<span class="sd">        0.0         1.0       1.0       1.0</span>
<span class="sd">        1.0         1.0       1.0       1.0</span>
<span class="sd">        2.0         1.0       1.0       1.0</span>
<span class="sd">        3.0         1.0       1.0       1.0</span>
<span class="sd">        4.0         1.0       1.0       1.0</span>
<span class="sd">        Metadata</span>
<span class="sd">        --------    --------  --------  --------</span>
<span class="sd">        color       red       blue      green</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        dtype: float64, shape: (5, 3)</span>

<span class="sd">        To add metadata with a dictionary:</span>

<span class="sd">        &gt;&gt;&gt; metadata = {&quot;xpos&quot;: [10, 20, 30]}</span>
<span class="sd">        &gt;&gt;&gt; tsdframe.set_info(metadata)</span>
<span class="sd">        &gt;&gt;&gt; tsdframe</span>
<span class="sd">        Time (s)    a         b         c</span>
<span class="sd">        ----------  --------  --------  --------</span>
<span class="sd">        0.0         1.0       1.0       1.0</span>
<span class="sd">        1.0         1.0       1.0       1.0</span>
<span class="sd">        2.0         1.0       1.0       1.0</span>
<span class="sd">        3.0         1.0       1.0       1.0</span>
<span class="sd">        4.0         1.0       1.0       1.0</span>
<span class="sd">        Metadata</span>
<span class="sd">        --------    --------  --------  --------</span>
<span class="sd">        color       red       blue      green</span>
<span class="sd">        xpos        10        20        30</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        dtype: float64, shape: (5, 3)</span>

<span class="sd">        To add metadata with a keyword arument (pd.Series, numpy.ndarray, list or tuple):</span>

<span class="sd">        &gt;&gt;&gt; ypos = pd.Series(index=tsdframe.columns, data = [10, 10, 10])</span>
<span class="sd">        &gt;&gt;&gt; tsdframe.set_info(ypos=ypos)</span>
<span class="sd">        &gt;&gt;&gt; tsdframe</span>
<span class="sd">        Time (s)    a         b         c</span>
<span class="sd">        ----------  --------  --------  --------</span>
<span class="sd">        0.0         1.0       1.0       1.0</span>
<span class="sd">        1.0         1.0       1.0       1.0</span>
<span class="sd">        2.0         1.0       1.0       1.0</span>
<span class="sd">        3.0         1.0       1.0       1.0</span>
<span class="sd">        4.0         1.0       1.0       1.0</span>
<span class="sd">        Metadata</span>
<span class="sd">        --------    --------  --------  --------</span>
<span class="sd">        color       red       blue      green</span>
<span class="sd">        xpos        10        20        30</span>
<span class="sd">        ypos        10        10        10</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        dtype: float64, shape: (5, 3)</span>

<span class="sd">        To add metadata as an attribute:</span>

<span class="sd">        &gt;&gt;&gt; tsdframe.label = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]</span>
<span class="sd">        &gt;&gt;&gt; tsdframe</span>
<span class="sd">        Time (s)    a         b         c</span>
<span class="sd">        ----------  --------  --------  --------</span>
<span class="sd">        0.0         1.0       1.0       1.0</span>
<span class="sd">        1.0         1.0       1.0       1.0</span>
<span class="sd">        2.0         1.0       1.0       1.0</span>
<span class="sd">        3.0         1.0       1.0       1.0</span>
<span class="sd">        4.0         1.0       1.0       1.0</span>
<span class="sd">        Metadata</span>
<span class="sd">        --------    --------  --------  --------</span>
<span class="sd">        color       red       blue      green</span>
<span class="sd">        xpos        10        20        30</span>
<span class="sd">        ypos        10        10        10</span>
<span class="sd">        label       a         b         c</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        dtype: float64, shape: (5, 3)</span>

<span class="sd">        To add metadata as a key:</span>

<span class="sd">        &gt;&gt;&gt; tsdframe[&quot;region&quot;] = [&quot;M1&quot;, &quot;M1&quot;, &quot;M2&quot;]</span>
<span class="sd">        &gt;&gt;&gt; tsdframe</span>
<span class="sd">        Time (s)    a         b         c</span>
<span class="sd">        ----------  --------  --------  --------</span>
<span class="sd">        0.0         1.0       1.0       1.0</span>
<span class="sd">        1.0         1.0       1.0       1.0</span>
<span class="sd">        2.0         1.0       1.0       1.0</span>
<span class="sd">        3.0         1.0       1.0       1.0</span>
<span class="sd">        4.0         1.0       1.0       1.0</span>
<span class="sd">        Metadata</span>
<span class="sd">        --------    --------  --------  --------</span>
<span class="sd">        color       red       blue      green</span>
<span class="sd">        xpos        10        20        30</span>
<span class="sd">        ypos        10        10        10</span>
<span class="sd">        label       a         b         c</span>
<span class="sd">        region      M1        M1        M2</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        dtype: float64, shape: (5, 3)</span>

<span class="sd">        Metadata can be overwritten:</span>

<span class="sd">        &gt;&gt;&gt; tsdframe.set_info(label=[&quot;x&quot;, &quot;y&quot;, &quot;z&quot;])</span>
<span class="sd">        &gt;&gt;&gt; tsdframe</span>
<span class="sd">        Time (s)    a         b         c</span>
<span class="sd">        ----------  --------  --------  --------</span>
<span class="sd">        0.0         1.0       1.0       1.0</span>
<span class="sd">        1.0         1.0       1.0       1.0</span>
<span class="sd">        2.0         1.0       1.0       1.0</span>
<span class="sd">        3.0         1.0       1.0       1.0</span>
<span class="sd">        4.0         1.0       1.0       1.0</span>
<span class="sd">        Metadata</span>
<span class="sd">        --------    --------  --------  --------</span>
<span class="sd">        color       red       blue      green</span>
<span class="sd">        xpos        10        20        30</span>
<span class="sd">        ypos        10        10        10</span>
<span class="sd">        label       x         y         z</span>
<span class="sd">        region      M1        M1        M2</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        dtype: float64, shape: (5, 3)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_MetadataMixin</span><span class="o">.</span><span class="n">set_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="TsdFrame.get_info">
<a class="viewcode-back" href="../../../generated/pynapple.TsdFrame.get_info.html#pynapple.TsdFrame.get_info">[docs]</a>
    <span class="nd">@add_meta_docstring</span><span class="p">(</span><span class="s2">&quot;get_info&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; metadata = {&quot;l1&quot;: [1, 2, 3], &quot;l2&quot;: [&quot;x&quot;, &quot;x&quot;, &quot;y&quot;]}</span>
<span class="sd">        &gt;&gt;&gt; tsdframe = nap.TsdFrame(t=np.arange(5), d=np.ones((5, 3)), metadata=metadata)</span>
<span class="sd">        &gt;&gt;&gt; print(tsdframe)</span>
<span class="sd">        Time (s)    0    1    2</span>
<span class="sd">        ----------  ---  ---  ---</span>
<span class="sd">        0.0         1.0  1.0  1.0</span>
<span class="sd">        1.0         1.0  1.0  1.0</span>
<span class="sd">        2.0         1.0  1.0  1.0</span>
<span class="sd">        3.0         1.0  1.0  1.0</span>
<span class="sd">        4.0         1.0  1.0  1.0</span>
<span class="sd">        Metadata</span>
<span class="sd">        ----------  ---  ---  ---</span>
<span class="sd">        l1          1    2    3</span>
<span class="sd">        l2          x    x    y</span>
<span class="sd">        dtype: float64, shape: (5, 3)</span>

<span class="sd">        To access a single metadata row (transposed to column):</span>

<span class="sd">        &gt;&gt;&gt; tsdframe.get_info(&quot;l1&quot;)</span>
<span class="sd">        array([1, 2, 3])</span>

<span class="sd">        To access multiple metadata rows (transposed to columns):</span>

<span class="sd">        &gt;&gt;&gt; tsdframe.get_info([&quot;l1&quot;, &quot;l2&quot;])</span>
<span class="sd">             l1    l2</span>
<span class="sd">        0    1     x</span>
<span class="sd">        1    2     x</span>
<span class="sd">        2    3     y</span>

<span class="sd">        To access metadata as an attribute:</span>

<span class="sd">        &gt;&gt;&gt; tsdframe.l1</span>
<span class="sd">        array([1, 2, 3])</span>

<span class="sd">        To access metadata as a key:</span>

<span class="sd">        &gt;&gt;&gt; tsdframe[&quot;l1&quot;]</span>
<span class="sd">        array([1, 2, 3])</span>

<span class="sd">        Multiple metadata columns can be accessed as keys:</span>

<span class="sd">        &gt;&gt;&gt; tsdframe[[&quot;l1&quot;, &quot;l2&quot;]]</span>
<span class="sd">             l1    l2</span>
<span class="sd">        0    1     x</span>
<span class="sd">        1    2     x</span>
<span class="sd">        2    3     y</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_MetadataMixin</span><span class="o">.</span><span class="n">get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span></div>


<div class="viewcode-block" id="TsdFrame.drop_info">
<a class="viewcode-back" href="../../../generated/pynapple.TsdFrame.drop_info.html#pynapple.TsdFrame.drop_info">[docs]</a>
    <span class="nd">@add_meta_docstring</span><span class="p">(</span><span class="s2">&quot;drop_info&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">drop_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; metadata = {&quot;l1&quot;: [1, 2, 3], &quot;l2&quot;: [&quot;x&quot;, &quot;x&quot;, &quot;y&quot;], &quot;l3&quot;: [4, 5, 6]}</span>
<span class="sd">        &gt;&gt;&gt; tsdframe = nap.TsdFrame(t=np.arange(5), d=np.ones((5, 3)), metadata=metadata)</span>
<span class="sd">        &gt;&gt;&gt; print(tsdframe)</span>
<span class="sd">        Time (s)    0    1    2</span>
<span class="sd">        ----------  ---  ---  ---</span>
<span class="sd">        0.0         1.0  1.0  1.0</span>
<span class="sd">        1.0         1.0  1.0  1.0</span>
<span class="sd">        2.0         1.0  1.0  1.0</span>
<span class="sd">        3.0         1.0  1.0  1.0</span>
<span class="sd">        4.0         1.0  1.0  1.0</span>
<span class="sd">        Metadata</span>
<span class="sd">        ----------  ---  ---  ---</span>
<span class="sd">        l1          1    2    3</span>
<span class="sd">        l2          x    x    y</span>
<span class="sd">        l3          4    5    6</span>
<span class="sd">        dtype: float64, shape: (5, 3)</span>

<span class="sd">        To drop a single metadata row:</span>

<span class="sd">        &gt;&gt;&gt; tsdframe.drop_info(&quot;l1&quot;)</span>
<span class="sd">        &gt;&gt;&gt; tsdframe</span>
<span class="sd">        Time (s)    0    1    2</span>
<span class="sd">        ----------  ---  ---  ---</span>
<span class="sd">        0.0         1.0  1.0  1.0</span>
<span class="sd">        1.0         1.0  1.0  1.0</span>
<span class="sd">        2.0         1.0  1.0  1.0</span>
<span class="sd">        3.0         1.0  1.0  1.0</span>
<span class="sd">        4.0         1.0  1.0  1.0</span>
<span class="sd">        Metadata</span>
<span class="sd">        ----------  ---  ---  ---</span>
<span class="sd">        l2          x    x    y</span>
<span class="sd">        l3          4    5    6</span>
<span class="sd">        dtype: float64, shape: (5, 3)</span>

<span class="sd">        To drop multiple metadata rows:</span>

<span class="sd">        &gt;&gt;&gt; tsdframe.drop_info([&quot;l2&quot;, &quot;l3&quot;])</span>
<span class="sd">        &gt;&gt;&gt; tsdframe</span>
<span class="sd">          Time (s)    0    1    2</span>
<span class="sd">        ----------  ---  ---  ---</span>
<span class="sd">                 0    1    1    1</span>
<span class="sd">                 1    1    1    1</span>
<span class="sd">                 2    1    1    1</span>
<span class="sd">                 3    1    1    1</span>
<span class="sd">                 4    1    1    1</span>
<span class="sd">        dtype: float64, shape: (5, 3)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_MetadataMixin</span><span class="o">.</span><span class="n">drop_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span></div>


<div class="viewcode-block" id="TsdFrame.restrict_info">
<a class="viewcode-back" href="../../../generated/pynapple.TsdFrame.restrict_info.html#pynapple.TsdFrame.restrict_info">[docs]</a>
    <span class="nd">@add_meta_docstring</span><span class="p">(</span><span class="s2">&quot;restrict_info&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">restrict_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; metadata = {&quot;l1&quot;: [1, 2, 3], &quot;l2&quot;: [&quot;x&quot;, &quot;x&quot;, &quot;y&quot;], &quot;l3&quot;: [4, 5, 6]}</span>
<span class="sd">        &gt;&gt;&gt; tsdframe = nap.TsdFrame(t=np.arange(5), d=np.ones((5, 3)), metadata=metadata)</span>
<span class="sd">        &gt;&gt;&gt; print(tsdframe)</span>
<span class="sd">        Time (s)    0    1    2</span>
<span class="sd">        ----------  ---  ---  ---</span>
<span class="sd">        0.0         1.0  1.0  1.0</span>
<span class="sd">        1.0         1.0  1.0  1.0</span>
<span class="sd">        2.0         1.0  1.0  1.0</span>
<span class="sd">        3.0         1.0  1.0  1.0</span>
<span class="sd">        4.0         1.0  1.0  1.0</span>
<span class="sd">        Metadata</span>
<span class="sd">        ----------  ---  ---  ---</span>
<span class="sd">        l1          1    2    3</span>
<span class="sd">        l2          x    x    y</span>
<span class="sd">        l3          4    5    6</span>
<span class="sd">        dtype: float64, shape: (5, 3)</span>

<span class="sd">        To restrict to multiple metadata rows:</span>

<span class="sd">        &gt;&gt;&gt; tsdframe.restrict_info([&quot;l2&quot;, &quot;l3&quot;])</span>
<span class="sd">        &gt;&gt;&gt; tsdframe</span>
<span class="sd">        Time (s)    0    1    2</span>
<span class="sd">        ----------  ---  ---  ---</span>
<span class="sd">        0.0         1.0  1.0  1.0</span>
<span class="sd">        1.0         1.0  1.0  1.0</span>
<span class="sd">        2.0         1.0  1.0  1.0</span>
<span class="sd">        3.0         1.0  1.0  1.0</span>
<span class="sd">        4.0         1.0  1.0  1.0</span>
<span class="sd">        Metadata</span>
<span class="sd">        ----------  ---  ---  ---</span>
<span class="sd">        l2          x    x    y</span>
<span class="sd">        l3          4    5    6</span>
<span class="sd">        dtype: float64, shape: (5, 3)</span>

<span class="sd">        To restrict to a single metadata row:</span>

<span class="sd">        &gt;&gt;&gt; tsdframe.restrict_info(&quot;l2&quot;)</span>
<span class="sd">        &gt;&gt;&gt; tsdframe</span>
<span class="sd">          Time (s)    0    1    2</span>
<span class="sd">        ----------  ---  ---  ---</span>
<span class="sd">                 0    1    1    1</span>
<span class="sd">                 1    1    1    1</span>
<span class="sd">                 2    1    1    1</span>
<span class="sd">                 3    1    1    1</span>
<span class="sd">                 4    1    1    1</span>
<span class="sd">        Metadata</span>
<span class="sd">        ----------  ---  ---  ---</span>
<span class="sd">        l2          x    x    y</span>
<span class="sd">        dtype: float64, shape: (5, 3)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_MetadataMixin</span><span class="o">.</span><span class="n">restrict_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span></div>


<div class="viewcode-block" id="TsdFrame.groupby">
<a class="viewcode-back" href="../../../generated/pynapple.TsdFrame.groupby.html#pynapple.TsdFrame.groupby">[docs]</a>
    <span class="nd">@add_or_convert_metadata</span>
    <span class="nd">@add_meta_docstring</span><span class="p">(</span><span class="s2">&quot;groupby&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="n">get_group</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; metadata = {&quot;l1&quot;: [1, 2, 2], &quot;l2&quot;: [&quot;x&quot;, &quot;x&quot;, &quot;y&quot;]}</span>
<span class="sd">        &gt;&gt;&gt; tsdframe = nap.TsdFrame(t=np.arange(5), d=np.ones((5, 3)), metadata=metadata)</span>
<span class="sd">        &gt;&gt;&gt; print(tsdframe)</span>
<span class="sd">        Time (s)    0         1         2</span>
<span class="sd">        ----------  --------  --------  --------</span>
<span class="sd">        0.0         1.0       1.0       1.0</span>
<span class="sd">        1.0         1.0       1.0       1.0</span>
<span class="sd">        2.0         1.0       1.0       1.0</span>
<span class="sd">        3.0         1.0       1.0       1.0</span>
<span class="sd">        4.0         1.0       1.0       1.0</span>
<span class="sd">        Metadata</span>
<span class="sd">        --------    --------  --------  --------</span>
<span class="sd">        l1          1         2         2</span>
<span class="sd">        l2          x         x         y</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        dtype: float64, shape: (5, 3)</span>

<span class="sd">        Grouping by a single row:</span>

<span class="sd">        &gt;&gt;&gt; tsdframe.groupby(&quot;l2&quot;)</span>
<span class="sd">        {&#39;x&#39;: [0, 1], &#39;y&#39;: [2]}</span>

<span class="sd">        Grouping by multiple rows:</span>

<span class="sd">        &gt;&gt;&gt; tsdframe.groupby([&quot;l1&quot;,&quot;l2&quot;])</span>
<span class="sd">        {(1, &#39;x&#39;): [0], (2, &#39;x&#39;): [1], (2, &#39;y&#39;): [2]}</span>

<span class="sd">        Filtering to a specific group using the output dictionary:</span>

<span class="sd">        &gt;&gt;&gt; groups = tsdframe.groupby(&quot;l2&quot;)</span>
<span class="sd">        &gt;&gt;&gt; tsdframe[:,groups[&quot;x&quot;]]</span>
<span class="sd">        Time (s)    0         1</span>
<span class="sd">        ----------  --------  --------</span>
<span class="sd">        0.0         1.0       1.0</span>
<span class="sd">        1.0         1.0       1.0</span>
<span class="sd">        2.0         1.0       1.0</span>
<span class="sd">        3.0         1.0       1.0</span>
<span class="sd">        4.0         1.0       1.0</span>
<span class="sd">        Metadata</span>
<span class="sd">        --------    --------  --------</span>
<span class="sd">        l1          1         2</span>
<span class="sd">        l2          x         x</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        dtype: float64, shape: (5, 2)</span>

<span class="sd">        Filtering to a specific group using the get_group argument:</span>

<span class="sd">        &gt;&gt;&gt; tsdframe.groupby(&quot;l2&quot;, get_group=&quot;x&quot;)</span>
<span class="sd">        Time (s)    0         1</span>
<span class="sd">        ----------  --------  --------</span>
<span class="sd">        0.0         1.0       1.0</span>
<span class="sd">        1.0         1.0       1.0</span>
<span class="sd">        2.0         1.0       1.0</span>
<span class="sd">        3.0         1.0       1.0</span>
<span class="sd">        4.0         1.0       1.0</span>
<span class="sd">        Metadata</span>
<span class="sd">        --------    --------  --------</span>
<span class="sd">        l1          1         2</span>
<span class="sd">        l2          x         x</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        dtype: float64, shape: (5, 2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_MetadataMixin</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="n">get_group</span><span class="p">)</span></div>


<div class="viewcode-block" id="TsdFrame.groupby_apply">
<a class="viewcode-back" href="../../../generated/pynapple.TsdFrame.groupby_apply.html#pynapple.TsdFrame.groupby_apply">[docs]</a>
    <span class="nd">@add_meta_docstring</span><span class="p">(</span><span class="s2">&quot;groupby_apply&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">groupby_apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">input_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">func_kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; metadata = {&quot;l1&quot;: [1, 2, 2], &quot;l2&quot;: [&quot;x&quot;, &quot;x&quot;, &quot;y&quot;]}</span>
<span class="sd">        &gt;&gt;&gt; tsdframe = nap.TsdFrame(t=np.arange(5), d=np.ones((5, 3)), metadata=metadata)</span>
<span class="sd">        &gt;&gt;&gt; print(tsdframe)</span>
<span class="sd">        Time (s)    0         1         2</span>
<span class="sd">        ----------  --------  --------  --------</span>
<span class="sd">        0.0         1.0       1.0       1.0</span>
<span class="sd">        1.0         1.0       1.0       1.0</span>
<span class="sd">        2.0         1.0       1.0       1.0</span>
<span class="sd">        3.0         1.0       1.0       1.0</span>
<span class="sd">        4.0         1.0       1.0       1.0</span>
<span class="sd">        Metadata</span>
<span class="sd">        --------    --------  --------  --------</span>
<span class="sd">        l1          1         2         2</span>
<span class="sd">        l2          x         x         y</span>
<span class="sd">        &lt;BLANKLINE&gt;</span>
<span class="sd">        dtype: float64, shape: (5, 3)</span>

<span class="sd">        Apply a numpy function:</span>

<span class="sd">        &gt;&gt;&gt; tsdframe.groupby_apply(&quot;l1&quot;, np.sum)</span>
<span class="sd">        {1: 5.0, 2: 10.0}</span>

<span class="sd">        Apply a custom function:</span>

<span class="sd">        &gt;&gt;&gt; tsdframe.groupby_apply(&quot;l1&quot;, lambda x: x.shape)</span>
<span class="sd">        {1: (5, 1), 2: (5, 2)}</span>

<span class="sd">        Apply a function with additional arguments:</span>

<span class="sd">        &gt;&gt;&gt; tsdframe.groupby_apply(&quot;l1&quot;, np.sum, axis=0)</span>
<span class="sd">        {1: array([5.]), 2: array([5., 5.])}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_MetadataMixin</span><span class="o">.</span><span class="n">groupby_apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">input_key</span><span class="p">,</span> <span class="o">**</span><span class="n">func_kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Tsd">
<a class="viewcode-back" href="../../../generated/pynapple.Tsd.html#pynapple.Tsd">[docs]</a>
<span class="k">class</span> <span class="nc">Tsd</span><span class="p">(</span><span class="n">_BaseTsd</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1-dimensional container for neurophysiological time series.</span>

<span class="sd">    Tsd provides standardized time representation, plus various functions for manipulating times series.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    rate : float</span>
<span class="sd">        Frequency of the time series (Hz) computed over the time support</span>
<span class="sd">    time_support : IntervalSet</span>
<span class="sd">        The time support of the time series</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Initialize a Tsd:</span>

<span class="sd">    &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; t = np.arange(100)</span>
<span class="sd">    &gt;&gt;&gt; d = np.ones(100)</span>
<span class="sd">    &gt;&gt;&gt; tsd = nap.Tsd(t=t, d=d)</span>
<span class="sd">    &gt;&gt;&gt; tsd</span>
<span class="sd">    Time (s)</span>
<span class="sd">    ----------  --</span>
<span class="sd">    0.0          1</span>
<span class="sd">    1.0          1</span>
<span class="sd">    2.0          1</span>
<span class="sd">    3.0          1</span>
<span class="sd">    4.0          1</span>
<span class="sd">    5.0          1</span>
<span class="sd">    6.0          1</span>
<span class="sd">    ...</span>
<span class="sd">    93.0         1</span>
<span class="sd">    94.0         1</span>
<span class="sd">    95.0         1</span>
<span class="sd">    96.0         1</span>
<span class="sd">    97.0         1</span>
<span class="sd">    98.0         1</span>
<span class="sd">    99.0         1</span>
<span class="sd">    dtype: float64, shape: (100,)</span>

<span class="sd">    Initialize a Tsd with `time_support`:</span>

<span class="sd">    &gt;&gt;&gt; t = np.arange(100)</span>
<span class="sd">    &gt;&gt;&gt; d = np.ones(100)</span>
<span class="sd">    &gt;&gt;&gt; time_support = nap.IntervalSet(start=0.5, end=8)</span>
<span class="sd">    &gt;&gt;&gt; tsd = nap.Tsd(t=t, d=d, time_support=time_support)</span>
<span class="sd">    &gt;&gt;&gt; tsd</span>
<span class="sd">    Time (s)</span>
<span class="sd">    ----------  --</span>
<span class="sd">    1            1</span>
<span class="sd">    2            1</span>
<span class="sd">    3            1</span>
<span class="sd">    4            1</span>
<span class="sd">    5            1</span>
<span class="sd">    6            1</span>
<span class="sd">    7            1</span>
<span class="sd">    8            1</span>
<span class="sd">    dtype: float64, shape: (8,)</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Tsd.__init__">
<a class="viewcode-back" href="../../../generated/pynapple.Tsd.__init__.html#pynapple.Tsd.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_units</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">time_support</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">load_array</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tsd Initializer.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        t : numpy.ndarray or pandas.Series</span>
<span class="sd">            An object transformable in a time series, or a pandas.Series equivalent (if d is None)</span>
<span class="sd">        d : numpy.ndarray, optional</span>
<span class="sd">            The data of the time series</span>
<span class="sd">        time_units : str, optional</span>
<span class="sd">            The time units in which times are specified (&#39;us&#39;, &#39;ms&#39;, &#39;s&#39; [default])</span>
<span class="sd">        time_support : IntervalSet, optional</span>
<span class="sd">            The time support of the tsd object</span>
<span class="sd">        load_array : bool, optional</span>
<span class="sd">            Whether the data should be converted to a numpy (or jax) array. Useful when passing a memory map object like zarr.</span>
<span class="sd">            Default is True. Does not apply if `d` is already a numpy array or a numpy memory map.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">values</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Missing argument d when initializing Tsd&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">time_units</span><span class="p">,</span> <span class="n">time_support</span><span class="p">,</span> <span class="n">load_array</span><span class="p">)</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Data should be 1 dimensional&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nap_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">True</span></div>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
        <span class="n">bottom</span> <span class="o">=</span> <span class="s2">&quot;dtype: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, shape: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">max_rows</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">_get_terminal_size</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">max_rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_rows</span><span class="p">:</span>
                    <span class="n">n_rows</span> <span class="o">=</span> <span class="n">max_rows</span> <span class="o">//</span> <span class="mi">2</span>
                    <span class="n">table</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n_rows</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n_rows</span><span class="p">]):</span>
                        <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">v</span><span class="p">])</span>
                    <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;...&quot;</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="n">n_rows</span><span class="p">:],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">n_rows</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="p">],</span>
                    <span class="p">):</span>
                        <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">v</span><span class="p">])</span>

                    <span class="k">return</span> <span class="p">(</span>
                        <span class="n">tabulate</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">colalign</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,))</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="n">bottom</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">(</span>
                        <span class="n">tabulate</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                            <span class="n">colalign</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,),</span>
                        <span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="o">+</span> <span class="n">bottom</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">tabulate</span><span class="p">([],</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">bottom</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">Tsd</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;When indexing with a Tsd, it must contain boolean values&quot;</span>
                <span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">d</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">new_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_indexer</span><span class="p">([</span><span class="n">key</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">((</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">new_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;__iter__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key</span><span class="p">]):</span>
                <span class="n">new_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_indexer</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">((</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">new_key</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">Tsd</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;When indexing with a Tsd, it must contain boolean values&quot;</span>
                <span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">d</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">key</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_initialize_tsd_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">time_index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="Tsd.as_series">
<a class="viewcode-back" href="../../../generated/pynapple.Tsd.as_series.html#pynapple.Tsd.as_series">[docs]</a>
    <span class="k">def</span> <span class="nf">as_series</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert the Ts/Tsd object to a pandas.Series object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out: pandas.Series</span>
<span class="sd">            _</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Tsd.as_units">
<a class="viewcode-back" href="../../../generated/pynapple.Tsd.as_units.html#pynapple.Tsd.as_units">[docs]</a>
    <span class="k">def</span> <span class="nf">as_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a pandas Series with time expressed in the desired unit.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        units : str, optional</span>
<span class="sd">            (&#39;us&#39;, &#39;ms&#39;, &#39;s&#39; [default])</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas.Series</span>
<span class="sd">            the series object with adjusted times</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_series</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="n">units</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;us&quot;</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="n">ss</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">t</span>
        <span class="n">ss</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Time (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">units</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
        <span class="k">return</span> <span class="n">ss</span></div>


<div class="viewcode-block" id="Tsd.threshold">
<a class="viewcode-back" href="../../../generated/pynapple.Tsd.threshold.html#pynapple.Tsd.threshold">[docs]</a>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thr</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;above&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply a threshold function to the tsd to return a new tsd</span>
<span class="sd">        with the time support being the epochs above/below/&gt;=/&lt;= the threshold</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        thr : float</span>
<span class="sd">            The threshold value</span>
<span class="sd">        method : str, optional</span>
<span class="sd">            The threshold method (&quot;above&quot;[default], &quot;below&quot;, &quot;aboveequal&quot;, &quot;belowequal&quot;)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out: Tsd</span>
<span class="sd">            All the time points below/ above/greater than equal to/less than equal to the threshold</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Raise an error if method is unknown.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            Raise an error if thr is too high/low and no epochs is found.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        This example finds all epoch above 0.5 within the tsd object.</span>

<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; tsd = nap.Tsd(t=np.arange(100), d=np.random.rand(100))</span>
<span class="sd">        &gt;&gt;&gt; newtsd = tsd.threshold(0.5)</span>

<span class="sd">        The epochs with the times above/below the threshold can be accessed through the time support:</span>

<span class="sd">        &gt;&gt;&gt; tsd = nap.Tsd(t=np.arange(100), d=np.arange(100), time_units=&#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tsd.threshold(50).time_support</span>
<span class="sd">        &gt;&gt;&gt;    start   end</span>
<span class="sd">        &gt;&gt;&gt; 0   50.5  99.0</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;above&quot;</span><span class="p">,</span> <span class="s2">&quot;below&quot;</span><span class="p">,</span> <span class="s2">&quot;aboveequal&quot;</span><span class="p">,</span> <span class="s2">&quot;belowequal&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Method </span><span class="si">{}</span><span class="s2"> for thresholding is not accepted.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">time_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
        <span class="n">data_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>
        <span class="n">starts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_support</span><span class="o">.</span><span class="n">start</span>
        <span class="n">ends</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_support</span><span class="o">.</span><span class="n">end</span>

        <span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">ne</span> <span class="o">=</span> <span class="n">_threshold</span><span class="p">(</span><span class="n">time_array</span><span class="p">,</span> <span class="n">data_array</span><span class="p">,</span> <span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">,</span> <span class="n">thr</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
        <span class="n">time_support</span> <span class="o">=</span> <span class="n">IntervalSet</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">ns</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">ne</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Tsd</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">time_support</span><span class="o">=</span><span class="n">time_support</span><span class="p">)</span></div>


<div class="viewcode-block" id="Tsd.get_slice">
<a class="viewcode-back" href="../../../generated/pynapple.Tsd.get_slice.html#pynapple.Tsd.get_slice">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;get_slice&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_unit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; tsd = nap.Tsd(t = [0, 1, 2, 3], d = [1, 1, 1, 1])</span>

<span class="sd">        Slice over a range:</span>

<span class="sd">        &gt;&gt;&gt; tsd.get_slice(1.2, 2.6)</span>
<span class="sd">        slice(np.int64(2), np.int64(3), None)</span>
<span class="sd">        &gt;&gt;&gt; tsd.get_slice(1.0, 2.0)</span>
<span class="sd">        slice(np.int64(1), np.int64(3), None)</span>

<span class="sd">        Slice a single value:</span>

<span class="sd">        &gt;&gt;&gt; tsd.get_slice(1.2)</span>
<span class="sd">        slice(np.int64(1), np.int64(2), None)</span>
<span class="sd">        &gt;&gt;&gt; tsd.get_slice(2.0)</span>
<span class="sd">        slice(np.int64(2), np.int64(3), None)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">get_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">time_unit</span><span class="p">)</span></div>


<div class="viewcode-block" id="Tsd.count">
<a class="viewcode-back" href="../../../generated/pynapple.Tsd.count.html#pynapple.Tsd.count">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bin_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_units</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        This example shows how to count timestamps within bins of 0.1 second.</span>

<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np; np.random.seed(42)</span>
<span class="sd">        &gt;&gt;&gt; t = np.unique(np.sort(np.random.randint(0, 1000, 100))) # random times</span>
<span class="sd">        &gt;&gt;&gt; tsd = nap.Tsd(t=t, d=np.random.randn(len(t)), time_units=&#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tsd</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  ---------</span>
<span class="sd">        1.0         -2.17833</span>
<span class="sd">        13.0        -1.0439</span>
<span class="sd">        20.0         0.172694</span>
<span class="sd">        21.0         0.324199</span>
<span class="sd">        34.0         0.74586</span>
<span class="sd">        58.0        -1.83658</span>
<span class="sd">        ...</span>
<span class="sd">        897.0       -0.762627</span>
<span class="sd">        931.0        0.168659</span>
<span class="sd">        942.0       -1.32188</span>
<span class="sd">        955.0       -0.668247</span>
<span class="sd">        957.0       -0.137291</span>
<span class="sd">        975.0        1.40132</span>
<span class="sd">        dtype: float64, shape: (94,)</span>

<span class="sd">        tsd is a timestamp object with data.</span>

<span class="sd">        &gt;&gt;&gt; ep = nap.IntervalSet(start = 0, end = 500, time_units = &#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ep</span>
<span class="sd">          index    start    end</span>
<span class="sd">              0        0    500</span>
<span class="sd">        shape: (1, 2), time unit: sec.</span>

<span class="sd">        ep is an IntervalSet object defining the epochs.</span>

<span class="sd">        &gt;&gt;&gt; bincount = tsd.count(10.0, ep=ep)</span>
<span class="sd">        &gt;&gt;&gt; bincount</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  --</span>
<span class="sd">        5.0          1</span>
<span class="sd">        15.0         1</span>
<span class="sd">        25.0         2</span>
<span class="sd">        35.0         1</span>
<span class="sd">        45.0         0</span>
<span class="sd">        55.0         1</span>
<span class="sd">        ...</span>
<span class="sd">        445.0        0</span>
<span class="sd">        455.0        3</span>
<span class="sd">        465.0        1</span>
<span class="sd">        475.0        3</span>
<span class="sd">        485.0        1</span>
<span class="sd">        495.0        1</span>
<span class="sd">        dtype: int64, shape: (50,)</span>
<span class="sd">        &gt;&gt;&gt; bincount.time_support</span>
<span class="sd">          index    start    end</span>
<span class="sd">              0        0    500</span>
<span class="sd">        shape: (1, 2), time unit: sec.</span>

<span class="sd">        bincount automatically inherits ep as time support.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bin_size</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="n">time_units</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span></div>


<div class="viewcode-block" id="Tsd.restrict">
<a class="viewcode-back" href="../../../generated/pynapple.Tsd.restrict.html#pynapple.Tsd.restrict">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;restrict&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">restrict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iset</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np; np.random.seed(42)</span>
<span class="sd">        &gt;&gt;&gt; t = np.unique(np.sort(np.random.randint(0, 1000, 100))) # random times</span>
<span class="sd">        &gt;&gt;&gt; tsd_before = nap.Tsd(t=t, d=np.random.rand(len(t)), time_units=&#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tsd_before</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  ---------</span>
<span class="sd">        1.0         0.449754</span>
<span class="sd">        13.0        0.39515</span>
<span class="sd">        20.0        0.926659</span>
<span class="sd">        21.0        0.727272</span>
<span class="sd">        34.0        0.326541</span>
<span class="sd">        58.0        0.570444</span>
<span class="sd">        71.0        0.520834</span>
<span class="sd">        ...</span>
<span class="sd">        875.0       0.0648922</span>
<span class="sd">        897.0       0.253915</span>
<span class="sd">        931.0       0.246876</span>
<span class="sd">        942.0       0.696304</span>
<span class="sd">        955.0       0.712271</span>
<span class="sd">        957.0       0.148087</span>
<span class="sd">        975.0       0.99774</span>
<span class="sd">        dtype: float64, shape: (94,)</span>

<span class="sd">        tsd_before is a timestamp object with data.</span>

<span class="sd">        &gt;&gt;&gt; ep = nap.IntervalSet(start = 0, end = 500, time_units = &#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ep</span>
<span class="sd">          index    start    end</span>
<span class="sd">              0        0    500</span>
<span class="sd">        shape: (1, 2), time unit: sec.</span>

<span class="sd">        ep is an IntervalSet object defining the epochs.</span>

<span class="sd">        &gt;&gt;&gt; ep = nap.IntervalSet(start = 0, end = 500, time_units = &#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tsd_after = tsd_before.restrict(ep)</span>
<span class="sd">        &gt;&gt;&gt; tsd_after</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  --------</span>
<span class="sd">        1.0         0.449754</span>
<span class="sd">        13.0        0.39515</span>
<span class="sd">        20.0        0.926659</span>
<span class="sd">        21.0        0.727272</span>
<span class="sd">        34.0        0.326541</span>
<span class="sd">        58.0        0.570444</span>
<span class="sd">        71.0        0.520834</span>
<span class="sd">        ...</span>
<span class="sd">        459.0       0.110891</span>
<span class="sd">        466.0       0.439337</span>
<span class="sd">        474.0       0.201719</span>
<span class="sd">        475.0       0.895764</span>
<span class="sd">        476.0       0.47537</span>
<span class="sd">        484.0       0.563276</span>
<span class="sd">        491.0       0.695516</span>
<span class="sd">        dtype: float64, shape: (53,)</span>

<span class="sd">        tsd_after is a timestamp object restricted to the epochs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">restrict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iset</span><span class="p">)</span></div>


<div class="viewcode-block" id="Tsd.in_interval">
<a class="viewcode-back" href="../../../generated/pynapple.Tsd.in_interval.html#pynapple.Tsd.in_interval">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;in_interval&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">in_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iset</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; t = np.arange(100)</span>
<span class="sd">        &gt;&gt;&gt; ep = nap.IntervalSet(start=0, end=50)</span>
<span class="sd">        &gt;&gt;&gt; tsd = nap.Tsd(t=t, d=np.random.randn(len(t)))</span>
<span class="sd">        &gt;&gt;&gt; tsd.in_interval(ep)</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  --</span>
<span class="sd">        0.0          1</span>
<span class="sd">        1.0          1</span>
<span class="sd">        2.0          1</span>
<span class="sd">        3.0          1</span>
<span class="sd">        4.0          1</span>
<span class="sd">        5.0          1</span>
<span class="sd">        6.0          1</span>
<span class="sd">        ...</span>
<span class="sd">        93.0         0</span>
<span class="sd">        94.0         0</span>
<span class="sd">        95.0         0</span>
<span class="sd">        96.0         0</span>
<span class="sd">        97.0         0</span>
<span class="sd">        98.0         0</span>
<span class="sd">        99.0         0</span>
<span class="sd">        dtype: bool, shape: (100,)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iset</span><span class="p">)</span></div>


<div class="viewcode-block" id="Tsd.value_from">
<a class="viewcode-back" href="../../../generated/pynapple.Tsd.value_from.html#pynapple.Tsd.value_from">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;value_from&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">value_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        In this example, a tsd object will receive the closest values in time from another tsd.</span>

<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np; np.random.seed(42)</span>
<span class="sd">        &gt;&gt;&gt; t = np.unique(np.sort(np.random.randint(0, 1000, 100))) # random times</span>
<span class="sd">        &gt;&gt;&gt; tsd_before = nap.Tsd(t=t, d=np.random.rand(len(t)), time_units=&#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tsd_before</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  ---------</span>
<span class="sd">        1.0         0.449754</span>
<span class="sd">        13.0        0.39515</span>
<span class="sd">        20.0        0.926659</span>
<span class="sd">        21.0        0.727272</span>
<span class="sd">        34.0        0.326541</span>
<span class="sd">        58.0        0.570444</span>
<span class="sd">        71.0        0.520834</span>
<span class="sd">        ...</span>
<span class="sd">        875.0       0.0648922</span>
<span class="sd">        897.0       0.253915</span>
<span class="sd">        931.0       0.246876</span>
<span class="sd">        942.0       0.696304</span>
<span class="sd">        955.0       0.712271</span>
<span class="sd">        957.0       0.148087</span>
<span class="sd">        975.0       0.99774</span>
<span class="sd">        dtype: float64, shape: (94,)</span>

<span class="sd">        tsd_before is a timestamp object with values.</span>

<span class="sd">        &gt;&gt;&gt; tsd_from = nap.Tsd(t=np.arange(0,1000), d=np.random.choice([1,2,3], 1000), time_units=&#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tsd_from</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  --</span>
<span class="sd">        0.0          3</span>
<span class="sd">        1.0          1</span>
<span class="sd">        2.0          2</span>
<span class="sd">        3.0          2</span>
<span class="sd">        4.0          2</span>
<span class="sd">        5.0          3</span>
<span class="sd">        6.0          1</span>
<span class="sd">        ...</span>
<span class="sd">        993.0        1</span>
<span class="sd">        994.0        2</span>
<span class="sd">        995.0        1</span>
<span class="sd">        996.0        1</span>
<span class="sd">        997.0        2</span>
<span class="sd">        998.0        2</span>
<span class="sd">        999.0        2</span>
<span class="sd">        dtype: int64, shape: (1000,)</span>

<span class="sd">        tsd_from contains values, for example the tracking data.</span>

<span class="sd">        &gt;&gt;&gt; ep = nap.IntervalSet(start = 0, end = 500, time_units = &#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ep</span>
<span class="sd">          index    start    end</span>
<span class="sd">              0        0    500</span>
<span class="sd">        shape: (1, 2), time unit: sec.</span>

<span class="sd">        An epoch can be passed to restrict the operation.</span>

<span class="sd">        &gt;&gt;&gt; tsd_after = tsd_before.value_from(tsd_from, ep, mode=&#39;closest&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tsd_after</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  --</span>
<span class="sd">        1.0          1</span>
<span class="sd">        13.0         2</span>
<span class="sd">        20.0         3</span>
<span class="sd">        21.0         2</span>
<span class="sd">        34.0         3</span>
<span class="sd">        58.0         1</span>
<span class="sd">        71.0         2</span>
<span class="sd">        ...</span>
<span class="sd">        459.0        3</span>
<span class="sd">        466.0        1</span>
<span class="sd">        474.0        3</span>
<span class="sd">        475.0        1</span>
<span class="sd">        476.0        2</span>
<span class="sd">        484.0        3</span>
<span class="sd">        491.0        1</span>
<span class="sd">        dtype: int64, shape: (53,)</span>

<span class="sd">        tsd_after is the same length as ts when restricted to ep.</span>

<span class="sd">        &gt;&gt;&gt; print(len(tsd_before.restrict(ep)), len(tsd_after))</span>
<span class="sd">        53 53</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">value_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span></div>


<div class="viewcode-block" id="Tsd.time_diff">
<a class="viewcode-back" href="../../../generated/pynapple.Tsd.time_diff.html#pynapple.Tsd.time_diff">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;time_diff&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">time_diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; tsd = nap.Tsd(t=[1, 3, 5, 6, 8, 12], d=[2, 2, 2, 3, 4, 5])</span>
<span class="sd">        &gt;&gt;&gt; epochs = nap.IntervalSet(start=2, end=9, time_units=&#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tsd_time_diffs = tsd.time_diff(align=&quot;center&quot;, epochs=epochs)</span>
<span class="sd">        &gt;&gt;&gt; tsd_time_diffs</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  --</span>
<span class="sd">        4            2</span>
<span class="sd">        5.5          1</span>
<span class="sd">        7            2</span>
<span class="sd">        dtype: float64, shape: (3,)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">time_diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">align</span><span class="p">,</span> <span class="n">epochs</span><span class="p">)</span></div>


<div class="viewcode-block" id="Tsd.to_tsgroup">
<a class="viewcode-back" href="../../../generated/pynapple.Tsd.to_tsgroup.html#pynapple.Tsd.to_tsgroup">[docs]</a>
    <span class="k">def</span> <span class="nf">to_tsgroup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert Tsd to a TsGroup by grouping timestamps with the same values.</span>
<span class="sd">        By default, the values are converted to integers.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; tsd = nap.Tsd(t = np.array([0, 1, 2, 3]), d = np.array([0, 2, 0, 1]))</span>
<span class="sd">        Time (s)</span>
<span class="sd">        0.0    0</span>
<span class="sd">        1.0    2</span>
<span class="sd">        2.0    0</span>
<span class="sd">        3.0    1</span>
<span class="sd">        dtype: int64</span>

<span class="sd">        &gt;&gt;&gt; tsd.to_tsgroup()</span>
<span class="sd">        Index    rate</span>
<span class="sd">        -------  ------</span>
<span class="sd">            0    0.67</span>
<span class="sd">            1    0.33</span>
<span class="sd">            2    0.33</span>

<span class="sd">        The reverse operation can be done with the TsGroup.to_tsd function :</span>

<span class="sd">        &gt;&gt;&gt; tsgroup.to_tsd()</span>
<span class="sd">        Time (s)</span>
<span class="sd">        0.0    0.0</span>
<span class="sd">        1.0    2.0</span>
<span class="sd">        2.0    0.0</span>
<span class="sd">        3.0    1.0</span>
<span class="sd">        dtype: float64</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TsGroup</span>
<span class="sd">            Grouped timestamps</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ts_group</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s2">&quot;.ts_group&quot;</span><span class="p">,</span> <span class="s2">&quot;pynapple.core&quot;</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

        <span class="n">group</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">:</span>
            <span class="n">group</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ts</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="n">d</span> <span class="o">==</span> <span class="n">k</span><span class="p">],</span> <span class="n">time_support</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_support</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ts_group</span><span class="o">.</span><span class="n">TsGroup</span><span class="p">(</span>
            <span class="n">group</span><span class="p">,</span> <span class="n">time_support</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_support</span><span class="p">,</span> <span class="n">bypass_check</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Tsd.save">
<a class="viewcode-back" href="../../../generated/pynapple.Tsd.save.html#pynapple.Tsd.save">[docs]</a>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save Tsd object in npz format. The file will contain the timestamps, the</span>
<span class="sd">        data and the time support.</span>

<span class="sd">        The main purpose of this function is to save small/medium sized time series</span>
<span class="sd">        objects. For example, you extracted one channel from your recording and</span>
<span class="sd">        filtered it. You can save the filtered channel as a npz to avoid</span>
<span class="sd">        reprocessing it.</span>

<span class="sd">        You can load the object with `nap.load_file`. Keys are &#39;t&#39;, &#39;d&#39;, &#39;start&#39;, &#39;end&#39; and &#39;type&#39;.</span>
<span class="sd">        See the example below.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            The filename</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; tsd = nap.Tsd(t=np.array([0., 1.]), d = np.array([2, 3]))</span>
<span class="sd">        &gt;&gt;&gt; tsd.save(&quot;my_path/my_tsd.npz&quot;)</span>

<span class="sd">        To load you file, you can use the `nap.load_file` function :</span>

<span class="sd">        &gt;&gt;&gt; tsd = nap.load_file(&quot;my_path/my_tsd.npz&quot;)</span>
<span class="sd">        &gt;&gt;&gt; tsd</span>
<span class="sd">        Time (s)</span>
<span class="sd">        0.0    2</span>
<span class="sd">        1.0    3</span>
<span class="sd">        dtype: int64</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If filename is not str, path does not exist or filename is a directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_support</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
            <span class="n">end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_support</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nap_class</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str_</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span></div>
</div>



<div class="viewcode-block" id="Ts">
<a class="viewcode-back" href="../../../generated/pynapple.Ts.html#pynapple.Ts">[docs]</a>
<span class="k">class</span> <span class="nc">Ts</span><span class="p">(</span><span class="n">_Base</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Timestamps only object for a time series with only time index.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    rate : float</span>
<span class="sd">        Frequency of the time series (Hz) computed over the time support</span>
<span class="sd">    time_support : IntervalSet</span>
<span class="sd">        The time support of the time series</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Ts.__init__">
<a class="viewcode-back" href="../../../generated/pynapple.Ts.__init__.html#pynapple.Ts.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">time_units</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">time_support</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ts Initializer</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        t : numpy.ndarray or pandas.Series</span>
<span class="sd">            An object transformable in timestamps, or a pandas.Series equivalent (if d is None)</span>
<span class="sd">        time_units : str, optional</span>
<span class="sd">            The time units in which times are specified (&#39;us&#39;, &#39;ms&#39;, &#39;s&#39; [default])</span>
<span class="sd">        time_support : IntervalSet, optional</span>
<span class="sd">            The time support of the Ts object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">time_units</span><span class="p">,</span> <span class="n">time_support</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time_support</span><span class="p">,</span> <span class="n">IntervalSet</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
            <span class="n">starts</span> <span class="o">=</span> <span class="n">time_support</span><span class="o">.</span><span class="n">start</span>
            <span class="n">ends</span> <span class="o">=</span> <span class="n">time_support</span><span class="o">.</span><span class="n">end</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">_restrict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">TsIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                <span class="n">time_support</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">time_support</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nap_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">True</span></div>


    <span class="k">def</span> <span class="nf">_define_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_index</span><span class="p">,</span> <span class="n">time_support</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define a new class instance.</span>

<span class="sd">        Optional parameters for initialization are either passed to the function or are grabbed from self.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">time_index</span><span class="p">,</span> <span class="n">time_support</span><span class="o">=</span><span class="n">time_support</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_initialize_tsd_output</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">values</span><span class="p">,</span>
                <span class="n">time_index</span><span class="o">=</span><span class="n">time_index</span><span class="p">,</span>
                <span class="n">time_support</span><span class="o">=</span><span class="n">time_support</span><span class="p">,</span>
                <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="s2">&quot;Time (s)&quot;</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">_get_terminal_size</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">max_rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_rows</span><span class="p">:</span>
            <span class="n">n_rows</span> <span class="o">=</span> <span class="n">max_rows</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">_str_</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n_rows</span><span class="p">]]</span>
                <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;...&quot;</span><span class="p">]</span>
                <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="n">n_rows</span><span class="p">:]]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_str_</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>

        <span class="n">bottom</span> <span class="o">=</span> <span class="s2">&quot;shape: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">upper</span><span class="p">,</span> <span class="n">_str_</span><span class="p">,</span> <span class="n">bottom</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">index</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">Ts</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">time_support</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_support</span><span class="p">)</span>

<div class="viewcode-block" id="Ts.as_series">
<a class="viewcode-back" href="../../../generated/pynapple.Ts.as_series.html#pynapple.Ts.as_series">[docs]</a>
    <span class="k">def</span> <span class="nf">as_series</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert the Ts/Tsd object to a pandas.Series object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out: pandas.Series</span>
<span class="sd">            _</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Ts.as_units">
<a class="viewcode-back" href="../../../generated/pynapple.Ts.as_units.html#pynapple.Ts.as_units">[docs]</a>
    <span class="k">def</span> <span class="nf">as_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a pandas Series with time expressed in the desired unit.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        units : str, optional</span>
<span class="sd">            (&#39;us&#39;, &#39;ms&#39;, &#39;s&#39; [default])</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas.Series</span>
<span class="sd">            the series object with adjusted times</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="n">units</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;us&quot;</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">)</span>
        <span class="n">ss</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Time (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">units</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
        <span class="k">return</span> <span class="n">ss</span></div>


<div class="viewcode-block" id="Ts.fillna">
<a class="viewcode-back" href="../../../generated/pynapple.Ts.fillna.html#pynapple.Ts.fillna">[docs]</a>
    <span class="k">def</span> <span class="nf">fillna</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Similar to pandas fillna function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : Number</span>
<span class="sd">            Value for filling</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Tsd</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Number</span><span class="p">),</span> <span class="s2">&quot;Only a scalar can be passed to fillna&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="n">d</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Tsd</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">time_support</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_support</span><span class="p">)</span></div>


<div class="viewcode-block" id="Ts.save">
<a class="viewcode-back" href="../../../generated/pynapple.Ts.save.html#pynapple.Ts.save">[docs]</a>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save Ts object in npz format. The file will contain the timestamps and</span>
<span class="sd">        the time support.</span>

<span class="sd">        The main purpose of this function is to save small/medium sized timestamps</span>
<span class="sd">        object.</span>

<span class="sd">        You can load the object with `nap.load_file`. Keys are &#39;t&#39;, &#39;start&#39; and &#39;end&#39; and &#39;type&#39;.</span>
<span class="sd">        See the example below.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            The filename</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; ts = nap.Ts(t=np.array([0., 1., 1.5]))</span>
<span class="sd">        &gt;&gt;&gt; ts.save(&quot;my_path/my_ts.npz&quot;)</span>

<span class="sd">        To load you file, you can use the `nap.load_file` function :</span>

<span class="sd">        &gt;&gt;&gt; ts = nap.load_file(&quot;my_path/my_ts.npz&quot;)</span>
<span class="sd">        &gt;&gt;&gt; ts</span>
<span class="sd">        Time (s)</span>
<span class="sd">        0.0</span>
<span class="sd">        1.0</span>
<span class="sd">        1.5</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If filename is not str, path does not exist or filename is a directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_support</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
            <span class="n">end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_support</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;Ts&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str_</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span></div>


<div class="viewcode-block" id="Ts.trial_count">
<a class="viewcode-back" href="../../../generated/pynapple.Ts.trial_count.html#pynapple.Ts.trial_count">[docs]</a>
    <span class="k">def</span> <span class="nf">trial_count</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="n">bin_size</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="n">padding_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">time_unit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return trial-based count tensor from an IntervalSet object. The shape of the tensor array is</span>
<span class="sd">        (number of trials, number of time bins).</span>

<span class="sd">        The `bin_size` parameter determines the number of time bins.</span>

<span class="sd">        The `align` parameter controls how the time series are aligned. If `align=&quot;start&quot;`, the time</span>
<span class="sd">        series are aligned to the start of each trial. If `align=&quot;end&quot;`, the time series are aligned</span>
<span class="sd">        to the end of each trial.</span>

<span class="sd">        If trials have uneven durations, the returned array is padded. The parameter `padding_value`</span>
<span class="sd">        determines which value is used to pad the array. Default is NaN.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ep : IntervalSet</span>
<span class="sd">            Epochs holding the trials. Each interval can be of unequal size.</span>
<span class="sd">        bin_size : Number</span>
<span class="sd">            The size of the time bins.</span>
<span class="sd">        align: str, optional</span>
<span class="sd">            How to align the time series (&#39;start&#39; [default], &#39;end&#39;)</span>
<span class="sd">        padding_value: Number, optional</span>
<span class="sd">            How to pad the array if unequal intervals. Default is np.nan.</span>
<span class="sd">        time_unit : str, optional</span>
<span class="sd">            Time units of the bin_size parameter (&#39;s&#39; [default], &#39;ms&#39;, &#39;us&#39;).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.ndarray</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If `time_unit` not in [&quot;s&quot;, &quot;ms&quot;, &quot;us&quot;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ep</span><span class="p">,</span> <span class="n">IntervalSet</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Argument ep should be of type IntervalSet&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">time_unit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="s2">&quot;us&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;time_unit should be &#39;s&#39;, &#39;ms&#39; or &#39;us&#39;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">align</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;align should be &#39;start&#39; or &#39;end&#39;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bin_size</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;bin_size should be of type int or float&quot;</span><span class="p">)</span>

        <span class="c1"># Determine size of tensor</span>
        <span class="n">bin_size</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">TsIndex</span><span class="o">.</span><span class="n">format_timestamps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">bin_size</span><span class="p">]),</span> <span class="n">time_unit</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">n_t</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">ep</span><span class="o">.</span><span class="n">end</span> <span class="o">+</span> <span class="n">bin_size</span> <span class="o">-</span> <span class="n">ep</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="n">bin_size</span><span class="p">)))</span>
        <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">bin_size</span><span class="o">=</span><span class="n">bin_size</span><span class="p">,</span> <span class="n">ep</span><span class="o">=</span><span class="n">ep</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ep</span><span class="p">),</span> <span class="n">n_t</span><span class="p">))</span> <span class="o">*</span> <span class="n">padding_value</span>
        <span class="n">n_ep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ep</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>  <span class="c1"># To trim to the minimum length</span>

        <span class="k">if</span> <span class="n">align</span> <span class="o">==</span> <span class="s2">&quot;start&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ep</span><span class="p">)):</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">count</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ep</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ep</span><span class="o">.</span><span class="n">end</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">values</span>
                <span class="n">n_ep</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">output</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span> <span class="p">:</span> <span class="n">tmp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="p">[:,</span> <span class="mi">0</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">n_ep</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">align</span> <span class="o">==</span> <span class="s2">&quot;end&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ep</span><span class="p">)):</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">count</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ep</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ep</span><span class="o">.</span><span class="n">end</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">values</span>
                <span class="n">n_ep</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">output</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="n">tmp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="p">[:,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">n_ep</span><span class="p">)</span> <span class="p">:]</span>

        <span class="k">return</span> <span class="n">output</span></div>


<div class="viewcode-block" id="Ts.get_slice">
<a class="viewcode-back" href="../../../generated/pynapple.Ts.get_slice.html#pynapple.Ts.get_slice">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;get_slice&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_unit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; ts = nap.Ts(t = [0, 1, 2, 3])</span>

<span class="sd">        Slice over a range:</span>

<span class="sd">        &gt;&gt;&gt; ts.get_slice(1.2, 2.6)</span>
<span class="sd">        slice(np.int64(2), np.int64(3), None)</span>
<span class="sd">        &gt;&gt;&gt; ts.get_slice(1.0, 2.0)</span>
<span class="sd">        slice(np.int64(1), np.int64(3), None)</span>

<span class="sd">        Slice a single value:</span>

<span class="sd">        &gt;&gt;&gt; ts.get_slice(1.2)</span>
<span class="sd">        slice(np.int64(1), np.int64(2), None)</span>
<span class="sd">        &gt;&gt;&gt; ts.get_slice(2.0)</span>
<span class="sd">        slice(np.int64(2), np.int64(3), None)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">get_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">time_unit</span><span class="p">)</span></div>


<div class="viewcode-block" id="Ts.count">
<a class="viewcode-back" href="../../../generated/pynapple.Ts.count.html#pynapple.Ts.count">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bin_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_units</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        This example shows how to count timestamps within bins of 0.1 second.</span>

<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np; np.random.seed(42)</span>
<span class="sd">        &gt;&gt;&gt; t = np.unique(np.sort(np.random.randint(0, 1000, 100))) # random times</span>
<span class="sd">        &gt;&gt;&gt; ts = nap.Ts(t=t, time_units=&#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ts</span>
<span class="sd">        Time (s)</span>
<span class="sd">        1.0</span>
<span class="sd">        13.0</span>
<span class="sd">        20.0</span>
<span class="sd">        21.0</span>
<span class="sd">        34.0</span>
<span class="sd">        58.0</span>
<span class="sd">        71.0</span>
<span class="sd">        ...</span>
<span class="sd">        897.0</span>
<span class="sd">        931.0</span>
<span class="sd">        942.0</span>
<span class="sd">        955.0</span>
<span class="sd">        957.0</span>
<span class="sd">        975.0</span>
<span class="sd">        shape: 94</span>

<span class="sd">        ts is a timestamp object.</span>

<span class="sd">        &gt;&gt;&gt; ep = nap.IntervalSet(start = 0, end = 500, time_units = &#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ep</span>
<span class="sd">          index    start    end</span>
<span class="sd">              0        0    500</span>
<span class="sd">        shape: (1, 2), time unit: sec.</span>

<span class="sd">        ep is an IntervalSet object defining the epochs.</span>

<span class="sd">        &gt;&gt;&gt; bincount = ts.count(10.0, ep=ep)</span>
<span class="sd">        &gt;&gt;&gt; bincount</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  --</span>
<span class="sd">        5.0          1</span>
<span class="sd">        15.0         1</span>
<span class="sd">        25.0         2</span>
<span class="sd">        35.0         1</span>
<span class="sd">        45.0         0</span>
<span class="sd">        55.0         1</span>
<span class="sd">        ...</span>
<span class="sd">        445.0        0</span>
<span class="sd">        455.0        3</span>
<span class="sd">        465.0        1</span>
<span class="sd">        475.0        3</span>
<span class="sd">        485.0        1</span>
<span class="sd">        495.0        1</span>
<span class="sd">        dtype: int64, shape: (50,)</span>
<span class="sd">        &gt;&gt;&gt; bincount.time_support</span>
<span class="sd">          index    start    end</span>
<span class="sd">              0        0    500</span>
<span class="sd">        shape: (1, 2), time unit: sec.</span>

<span class="sd">        bincount automatically inherits ep as time support.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bin_size</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="n">time_units</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span></div>


<div class="viewcode-block" id="Ts.restrict">
<a class="viewcode-back" href="../../../generated/pynapple.Ts.restrict.html#pynapple.Ts.restrict">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;restrict&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">restrict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iset</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np; np.random.seed(42)</span>
<span class="sd">        &gt;&gt;&gt; t = np.unique(np.sort(np.random.randint(0, 1000, 100))) # random times</span>
<span class="sd">        &gt;&gt;&gt; ts_before = nap.Ts(t=t, time_units=&#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ts_before</span>
<span class="sd">        Time (s)</span>
<span class="sd">        1.0</span>
<span class="sd">        13.0</span>
<span class="sd">        20.0</span>
<span class="sd">        21.0</span>
<span class="sd">        34.0</span>
<span class="sd">        58.0</span>
<span class="sd">        71.0</span>
<span class="sd">        ...</span>
<span class="sd">        897.0</span>
<span class="sd">        931.0</span>
<span class="sd">        942.0</span>
<span class="sd">        955.0</span>
<span class="sd">        957.0</span>
<span class="sd">        975.0</span>
<span class="sd">        shape: 94</span>

<span class="sd">        ts_before is a timestamp object.</span>

<span class="sd">        &gt;&gt;&gt; ep = nap.IntervalSet(start = 0, end = 500, time_units = &#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ep</span>
<span class="sd">          index    start    end</span>
<span class="sd">              0        0    500</span>
<span class="sd">        shape: (1, 2), time unit: sec.</span>

<span class="sd">        ep is an IntervalSet object defining the epochs.</span>

<span class="sd">        &gt;&gt;&gt; ts_after = ts_before.restrict(ep)</span>
<span class="sd">        &gt;&gt;&gt; ts_after</span>
<span class="sd">        Time (s)</span>
<span class="sd">        1.0</span>
<span class="sd">        13.0</span>
<span class="sd">        20.0</span>
<span class="sd">        21.0</span>
<span class="sd">        34.0</span>
<span class="sd">        58.0</span>
<span class="sd">        ...</span>
<span class="sd">        466.0</span>
<span class="sd">        474.0</span>
<span class="sd">        475.0</span>
<span class="sd">        476.0</span>
<span class="sd">        484.0</span>
<span class="sd">        491.0</span>
<span class="sd">        shape: 53</span>

<span class="sd">        ts_after is a timestamp object restricted to the epochs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">restrict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iset</span><span class="p">)</span></div>


<div class="viewcode-block" id="Ts.in_interval">
<a class="viewcode-back" href="../../../generated/pynapple.Ts.in_interval.html#pynapple.Ts.in_interval">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;in_interval&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">in_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iset</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; t = np.arange(100)</span>
<span class="sd">        &gt;&gt;&gt; ep = nap.IntervalSet(start=0, end=50)</span>
<span class="sd">        &gt;&gt;&gt; ts = nap.Ts(t)</span>
<span class="sd">        &gt;&gt;&gt; ts.in_interval(ep)</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  --</span>
<span class="sd">        0.0          1</span>
<span class="sd">        1.0          1</span>
<span class="sd">        2.0          1</span>
<span class="sd">        3.0          1</span>
<span class="sd">        4.0          1</span>
<span class="sd">        5.0          1</span>
<span class="sd">        6.0          1</span>
<span class="sd">        ...</span>
<span class="sd">        93.0         0</span>
<span class="sd">        94.0         0</span>
<span class="sd">        95.0         0</span>
<span class="sd">        96.0         0</span>
<span class="sd">        97.0         0</span>
<span class="sd">        98.0         0</span>
<span class="sd">        99.0         0</span>
<span class="sd">        dtype: bool, shape: (100,)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">in_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iset</span><span class="p">)</span></div>


<div class="viewcode-block" id="Ts.value_from">
<a class="viewcode-back" href="../../../generated/pynapple.Ts.value_from.html#pynapple.Ts.value_from">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;value_from&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">value_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        In this example, the ts object will receive the closest values in time from tsd.</span>

<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np; np.random.seed(42)</span>
<span class="sd">        &gt;&gt;&gt; t = np.unique(np.sort(np.random.randint(0, 1000, 100))) # random times</span>
<span class="sd">        &gt;&gt;&gt; ts = nap.Ts(t=t, time_units=&#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ts</span>
<span class="sd">        Time (s)</span>
<span class="sd">        1.0</span>
<span class="sd">        13.0</span>
<span class="sd">        20.0</span>
<span class="sd">        21.0</span>
<span class="sd">        34.0</span>
<span class="sd">        58.0</span>
<span class="sd">        71.0</span>
<span class="sd">        ...</span>
<span class="sd">        897.0</span>
<span class="sd">        931.0</span>
<span class="sd">        942.0</span>
<span class="sd">        955.0</span>
<span class="sd">        957.0</span>
<span class="sd">        975.0</span>
<span class="sd">        shape: 94</span>

<span class="sd">        ts is a timestamp object.</span>

<span class="sd">        &gt;&gt;&gt; tsd_from = nap.Tsd(t=np.arange(0,1000), d=np.random.choice([1,2,3], 1000), time_units=&#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tsd_from</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  --</span>
<span class="sd">        0.0          2</span>
<span class="sd">        1.0          2</span>
<span class="sd">        2.0          2</span>
<span class="sd">        3.0          2</span>
<span class="sd">        4.0          3</span>
<span class="sd">        5.0          3</span>
<span class="sd">        6.0          2</span>
<span class="sd">        ...</span>
<span class="sd">        993.0        1</span>
<span class="sd">        994.0        1</span>
<span class="sd">        995.0        2</span>
<span class="sd">        996.0        2</span>
<span class="sd">        997.0        2</span>
<span class="sd">        998.0        1</span>
<span class="sd">        999.0        3</span>
<span class="sd">        dtype: int64, shape: (1000,)</span>

<span class="sd">        tsd_from contains values, for example the tracking data.</span>

<span class="sd">        &gt;&gt;&gt; ep = nap.IntervalSet(start = 0, end = 500, time_units = &#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ep</span>
<span class="sd">          index    start    end</span>
<span class="sd">              0        0    500</span>
<span class="sd">        shape: (1, 2), time unit: sec.</span>

<span class="sd">        An epoch can be passed to restrict the operation.</span>

<span class="sd">        &gt;&gt;&gt; tsd_after = ts.value_from(tsd_from, ep, mode=&#39;closest&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tsd_after</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  --</span>
<span class="sd">        1.0          2</span>
<span class="sd">        13.0         3</span>
<span class="sd">        20.0         3</span>
<span class="sd">        21.0         1</span>
<span class="sd">        34.0         3</span>
<span class="sd">        58.0         1</span>
<span class="sd">        71.0         1</span>
<span class="sd">        ...</span>
<span class="sd">        459.0        3</span>
<span class="sd">        466.0        2</span>
<span class="sd">        474.0        2</span>
<span class="sd">        475.0        1</span>
<span class="sd">        476.0        3</span>
<span class="sd">        484.0        1</span>
<span class="sd">        491.0        3</span>
<span class="sd">        dtype: int64, shape: (53,)</span>

<span class="sd">        tsd_after is the same length as ts when restricted to ep.</span>

<span class="sd">        &gt;&gt;&gt; print(len(ts.restrict(ep)), len(tsd_after))</span>
<span class="sd">        53 53</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">value_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span></div>


<div class="viewcode-block" id="Ts.time_diff">
<a class="viewcode-back" href="../../../generated/pynapple.Ts.time_diff.html#pynapple.Ts.time_diff">[docs]</a>
    <span class="nd">@add_docstring</span><span class="p">(</span><span class="s2">&quot;time_diff&quot;</span><span class="p">,</span> <span class="n">_Base</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">time_diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pynapple as nap</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; ts = nap.Ts(t=[1, 3, 5, 6, 8, 12])</span>
<span class="sd">        &gt;&gt;&gt; epochs = nap.IntervalSet(start=2, end=9, time_units=&#39;s&#39;)</span>
<span class="sd">        &gt;&gt;&gt; tsd_time_diffs = ts.time_diff(align=&quot;center&quot;, epochs=epochs)</span>
<span class="sd">        &gt;&gt;&gt; tsd_time_diffs</span>
<span class="sd">        Time (s)</span>
<span class="sd">        ----------  --</span>
<span class="sd">        4            2</span>
<span class="sd">        5.5          1</span>
<span class="sd">        7            2</span>
<span class="sd">        dtype: float64, shape: (3,)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_Base</span><span class="o">.</span><span class="n">time_diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">align</span><span class="p">,</span> <span class="n">epochs</span><span class="p">)</span></div>
</div>

</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

<footer class="footer" style="border-top: 1px solid #ccc; padding-top: 10px">
  <div class="container">
    <div id="credits" style="width: 50%; float: left">
      <p>
      &#169; Copyright 2021-2025, <a href="https://www.simonsfoundation.org/people/guillaume-viejo/">pynapple authors</a>.<br/>
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> and the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/">PyData Theme</a>.<br/>
      </p>
    </div>
    <div id="version" style="color: #999; float: right; margin: 15px">v0.10.2</div>
    </div>
  </div>
</footer>
  </body>
</html>