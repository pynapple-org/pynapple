
<!DOCTYPE html>


<html lang="en" data-content_root="../" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Null distributions to test spatial firing &#8212; pynapple 0.10.2 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_contributors.css?v=f079e67e" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=f2caec9a" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=11e62b30"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=c57da192"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/tutorial_null_distributions';</script>
    <link rel="icon" href="../_static/Pynapple_final_icon.png"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Calcium Imaging" href="tutorial_calcium_imaging.html" />
    <link rel="prev" title="Streaming data from DANDI" href="tutorial_pynapple_dandi.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.10.2" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
    
    <img src="../_static/Pynapple_final_logo.png" class="logo__image only-light" alt="pynapple 0.10.2 documentation - Home"/>
    <img src="../_static/Pynapple_final_logo.png" class="logo__image only-dark pst-js-only" alt="pynapple 0.10.2 documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../installing.html">
    Installing
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guide.html">
    User guide
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../examples.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api.html">
    API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about.html">
    About us
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../releases.html">
    Releases
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../external.html">
    External projects
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../pynajax.html">
    GPU acceleration
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../citing.html">
    Citing
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pynapple-org/pynapple" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/thepynapple" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../installing.html">
    Installing
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guide.html">
    User guide
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../examples.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api.html">
    API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about.html">
    About us
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../releases.html">
    Releases
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../external.html">
    External projects
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../pynajax.html">
    GPU acceleration
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../citing.html">
    Citing
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pynapple-org/pynapple" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/thepynapple" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="tutorial_HD_dataset.html">Analysing head-direction cells</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="tutorial_pynapple_dandi.html">Streaming data from Dandi</a></li>
</ul>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Null distributions to test spatial firing</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="tutorial_calcium_imaging.html">Analyzing calcium imaging data</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="tutorial_wavelet_decomposition.html">Example wavelet decomposition</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="tutorial_phase_preferences.html">Example filtering</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="tutorial_ibl_choice_decoding.html">Trial-aligned choice decoding in International Brain Lab data</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../examples.html" class="nav-link">Examples</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Null distributions to test spatial firing</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="null-distributions-to-test-spatial-firing">
<h1>Null distributions to test spatial firing<a class="headerlink" href="#null-distributions-to-test-spatial-firing" title="Link to this heading">#</a></h1>
<p>Null distributions are ubiquitous in neuroscience.
The brain can be incredibly noisy, and thus we need to use adequate statistical quantification to separate meaningful observations from random fluctuations.
While statistics can be daunting, most often designing the right statistical test comes down to devising a good null distribution.
A null distribution should reflect the expected behavior of the system under the assumption of no real effect, without introducing unnecessary assumptions or simplifications.
We can then compare our observations to such a null distribution to decide whether there is an effect.</p>
<p>If you want to learn the in‚Äôs and out‚Äôs of statistical analysis of neural data, we‚Äôd advise picking up a <a class="reference external" href="https://link.springer.com/content/pdf/10.1007/978-1-4614-9602-1.pdf">book</a> about it!</p>
<p>In this tutorial, we will use Pynapple‚Äôs randomization module to generate various null distributions to test whether the activity of neurons is modulated by position.</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we&#39;ll import the packages we&#39;re going to use</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.inset_locator</span> <span class="kn">import</span> <span class="n">inset_axes</span>
<span class="kn">import</span> <span class="nn">pynapple</span> <span class="k">as</span> <span class="nn">nap</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">correlate2d</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">maximum_filter</span><span class="p">,</span>
    <span class="n">label</span><span class="p">,</span>
    <span class="n">center_of_mass</span><span class="p">,</span>
    <span class="n">rotate</span><span class="p">,</span>
    <span class="n">gaussian_filter</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">pynwb</span> <span class="kn">import</span> <span class="n">NWBHDF5IO</span>

<span class="kn">from</span> <span class="nn">dandi.dandiapi</span> <span class="kn">import</span> <span class="n">DandiAPIClient</span>
<span class="kn">import</span> <span class="nn">fsspec</span>
<span class="kn">from</span> <span class="nn">fsspec.implementations.cached</span> <span class="kn">import</span> <span class="n">CachingFileSystem</span>
<span class="kn">import</span> <span class="nn">h5py</span>

<span class="c1"># some configuration, you can ignore this</span>
<span class="n">custom_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;axes.spines.right&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;axes.spines.top&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;ticks&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;colorblind&quot;</span><span class="p">,</span> <span class="n">font_scale</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">rc</span><span class="o">=</span><span class="n">custom_params</span><span class="p">)</span>
<span class="n">xr</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="n">display_expand_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<section id="downloading-data-from-dandi">
<h2>Downloading data from DANDI<a class="headerlink" href="#downloading-data-from-dandi" title="Link to this heading">#</a></h2>
<p>We will start by downloading some data off of DANDI.
To do so, we need a dandiset ID, and a file path.
In this tutorial we will use data from <a class="reference external" href="https://dandiarchive.org/dandiset/000582/draft">dandiset 000582</a>, which was published in:<br />
<em>Sargolini, Francesca, et al. ‚ÄúConjunctive representation of position, direction, and velocity in entorhinal cortex.‚Äù Science 312.5774 (2006): 758-762</em></p>
<p>This dataset contains electrophysiology recordings from neurons in the entorhinal cortex, which are known to modulate their firing with position.</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dandiset</span> <span class="o">=</span> <span class="s2">&quot;000582&quot;</span>
<span class="n">session</span> <span class="o">=</span> <span class="s2">&quot;sub-10884/sub-10884_ses-03080402_behavior+ecephys.nwb&quot;</span>

<span class="k">with</span> <span class="n">DandiAPIClient</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="n">asset</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_dandiset</span><span class="p">(</span><span class="n">dandiset</span><span class="p">,</span> <span class="s2">&quot;draft&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_asset_by_path</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
    <span class="n">s3_url</span> <span class="o">=</span> <span class="n">asset</span><span class="o">.</span><span class="n">get_content_url</span><span class="p">(</span><span class="n">follow_redirects</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">strip_query</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fs</span> <span class="o">=</span> <span class="n">CachingFileSystem</span><span class="p">(</span>
    <span class="n">fs</span><span class="o">=</span><span class="n">fsspec</span><span class="o">.</span><span class="n">filesystem</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">),</span>
    <span class="n">cache_storage</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;~/.caches/nwb-cache&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()),</span>
<span class="p">)</span>
<span class="n">io</span> <span class="o">=</span> <span class="n">NWBHDF5IO</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">s3_url</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)),</span> <span class="n">load_namespaces</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">nwb</span> <span class="o">=</span> <span class="n">nap</span><span class="o">.</span><span class="n">NWBFile</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">lazy_loading</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">units</span> <span class="o">=</span> <span class="n">nwb</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span>
<span class="n">position</span> <span class="o">=</span> <span class="n">nwb</span><span class="p">[</span><span class="s2">&quot;SpatialSeriesLED1&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="spatial-tuning-curves">
<h2>Spatial tuning curves<a class="headerlink" href="#spatial-tuning-curves" title="Link to this heading">#</a></h2>
<p>We can then use <a class="reference internal" href="../generated/pynapple.process.tuning_curves.html#pynapple.process.tuning_curves.compute_tuning_curves" title="pynapple.process.tuning_curves.compute_tuning_curves"><span class="xref myst py py-func"><code class="docutils literal notranslate"><span class="pre">compute_tuning_curves</span></code></span></a> to compute the tuning curve for each neuron‚Äôs spikes with respect to the position of the animal:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tuning_curves</span> <span class="o">=</span> <span class="n">nap</span><span class="o">.</span><span class="n">compute_tuning_curves</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
    <span class="n">features</span><span class="o">=</span><span class="n">position</span><span class="p">,</span>
    <span class="n">feature_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">],</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)],</span>
    <span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># optional smoothing of tuning curves</span>
<span class="k">def</span> <span class="nf">gaussian_filter_nan</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">gaussian_filter</span><span class="p">((</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">a</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="n">sigma</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gaussian_filter</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">/</span> <span class="n">w</span>
<span class="n">tuning_curves_smooth</span> <span class="o">=</span> <span class="n">tuning_curves</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">tuning_curves_smooth</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">gaussian_filter_nan</span><span class="p">(</span><span class="n">tuning_curves</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># Setting some xarray.DataArray attributes, for beauty</span>
<span class="n">tuning_curves_smooth</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;firing rate&quot;</span>
<span class="n">tuning_curves_smooth</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;unit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Hz&quot;</span>
<span class="n">tuning_curves_smooth</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;unit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cm&quot;</span>
<span class="n">tuning_curves_smooth</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;unit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cm&quot;</span>
<span class="n">tuning_curves</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in notebooks */

:root {
  --xr-font-color0: var(
    --jp-content-font-color0,
    var(--pst-color-text-base rgba(0, 0, 0, 1))
  );
  --xr-font-color2: var(
    --jp-content-font-color2,
    var(--pst-color-text-base, rgba(0, 0, 0, 0.54))
  );
  --xr-font-color3: var(
    --jp-content-font-color3,
    var(--pst-color-text-base, rgba(0, 0, 0, 0.38))
  );
  --xr-border-color: var(
    --jp-border-color2,
    hsl(from var(--pst-color-on-background, white) h s calc(l - 10))
  );
  --xr-disabled-color: var(
    --jp-layout-color3,
    hsl(from var(--pst-color-on-background, white) h s calc(l - 40))
  );
  --xr-background-color: var(
    --jp-layout-color0,
    var(--pst-color-on-background, white)
  );
  --xr-background-color-row-even: var(
    --jp-layout-color1,
    hsl(from var(--pst-color-on-background, white) h s calc(l - 5))
  );
  --xr-background-color-row-odd: var(
    --jp-layout-color2,
    hsl(from var(--pst-color-on-background, white) h s calc(l - 15))
  );
}

html[theme="dark"],
html[data-theme="dark"],
body[data-theme="dark"],
body.vscode-dark {
  --xr-font-color0: var(
    --jp-content-font-color0,
    var(--pst-color-text-base, rgba(255, 255, 255, 1))
  );
  --xr-font-color2: var(
    --jp-content-font-color2,
    var(--pst-color-text-base, rgba(255, 255, 255, 0.54))
  );
  --xr-font-color3: var(
    --jp-content-font-color3,
    var(--pst-color-text-base, rgba(255, 255, 255, 0.38))
  );
  --xr-border-color: var(
    --jp-border-color2,
    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 10))
  );
  --xr-disabled-color: var(
    --jp-layout-color3,
    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 40))
  );
  --xr-background-color: var(
    --jp-layout-color0,
    var(--pst-color-on-background, #111111)
  );
  --xr-background-color-row-even: var(
    --jp-layout-color1,
    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 5))
  );
  --xr-background-color-row-odd: var(
    --jp-layout-color2,
    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 15))
  );
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
  line-height: 1.6;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-obj-name,
.xr-group-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-group-name::before {
  content: "üìÅ";
  padding-right: 0.3em;
}

.xr-group-name,
.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;
  margin-block-start: 0;
  margin-block-end: 0;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: inline-block;
  opacity: 0;
  height: 0;
  margin: 0;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
  border: 2px solid transparent !important;
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:focus + label {
  border: 2px solid var(--xr-font-color0) !important;
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: "‚ñ∫";
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: "‚ñº";
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-top: 4px;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-group-box {
  display: inline-grid;
  grid-template-columns: 0px 20px auto;
  width: 100%;
}

.xr-group-box-vline {
  grid-column-start: 1;
  border-right: 0.2em solid;
  border-color: var(--xr-border-color);
  width: 0px;
}

.xr-group-box-hline {
  grid-column-start: 2;
  grid-row-start: 1;
  height: 1em;
  width: 20px;
  border-bottom: 0.2em solid;
  border-color: var(--xr-border-color);
}

.xr-group-box-contents {
  grid-column-start: 3;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: "(";
}

.xr-dim-list:after {
  content: ")";
}

.xr-dim-list li:not(:last-child):after {
  content: ",";
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  border-color: var(--xr-background-color-row-odd);
  margin-bottom: 0;
  padding-top: 2px;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
  border-color: var(--xr-background-color-row-even);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  border-top: 2px dotted var(--xr-background-color);
  padding-bottom: 20px !important;
  padding-top: 10px !important;
}

.xr-var-attrs-in + label,
.xr-var-data-in + label,
.xr-index-data-in + label {
  padding: 0 1px;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-data > pre,
.xr-index-data > pre,
.xr-var-data > table > tbody > tr {
  background-color: transparent !important;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}

.xr-var-attrs-in:checked + label > .xr-icon-file-text2,
.xr-var-data-in:checked + label > .xr-icon-database,
.xr-index-data-in:checked + label > .xr-icon-database {
  color: var(--xr-font-color0);
  filter: drop-shadow(1px 1px 5px var(--xr-font-color2));
  stroke-width: 0.8px;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (unit: 6, X: 40, Y: 40)&gt; Size: 77kB
array([[[ 2.94117647,  0.        ,         nan, ...,  0.        ,
          0.        ,  1.38888889],
        [ 4.54545455,  0.        ,  7.89473684, ...,         nan,
                 nan,  0.        ],
        [ 0.        ,  0.        ,         nan, ...,         nan,
                 nan,  0.        ],
        ...,
        [ 0.        ,  0.        ,  0.        , ...,  0.        ,
          0.        ,  0.94339623],
        [ 0.        ,  4.16666667,  0.        , ...,  0.        ,
          0.        ,  2.7173913 ],
        [ 0.        ,  4.54545455,  0.        , ...,  4.54545455,
          0.90909091,  1.5625    ]],

       [[ 0.        ,  2.94117647,         nan, ...,  0.        ,
          0.        ,  0.        ],
        [ 0.        ,  0.52083333,  0.        , ...,         nan,
                 nan,  0.        ],
        [ 0.        ,  0.        ,         nan, ...,         nan,
                 nan,  0.        ],
...
        [ 0.        ,  0.        ,  8.33333333, ...,  7.44680851,
          5.        ,  3.4591195 ],
        [ 6.25      ,  0.        ,  0.92592593, ..., 12.06896552,
          3.48837209,  4.89130435],
        [ 0.        ,  0.        ,  0.        , ...,  9.09090909,
          4.54545455,  3.90625   ]],

       [[ 2.94117647,  0.        ,         nan, ...,  0.        ,
          0.        ,  2.77777778],
        [ 0.        ,  0.52083333,  0.        , ...,         nan,
                 nan,  0.        ],
        [ 0.        ,  0.        ,         nan, ...,         nan,
                 nan,  0.        ],
        ...,
        [ 0.        ,  0.        ,  0.        , ...,  5.31914894,
          5.        ,  1.88679245],
        [ 6.25      ,  0.        ,  8.33333333, ...,  0.        ,
          0.        ,  0.54347826],
        [ 9.52380952,  6.81818182,  3.84615385, ...,  7.57575758,
          9.09090909, 10.9375    ]]], shape=(6, 40, 40))
Coordinates:
  * unit     (unit) int64 48B 0 1 2 3 4 5
  * X        (X) float64 320B -48.75 -46.25 -43.75 -41.25 ... 43.75 46.25 48.75
  * Y        (Y) float64 320B -48.75 -46.25 -43.75 -41.25 ... 43.75 46.25 48.75
Attributes: (4)</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-obj-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>unit</span>: 6</li><li><span class='xr-has-index'>X</span>: 40</li><li><span class='xr-has-index'>Y</span>: 40</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-0aa2d6b4-313f-4dbc-9c85-5197f31245d8' class='xr-array-in' type='checkbox' checked><label for='section-0aa2d6b4-313f-4dbc-9c85-5197f31245d8' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>2.941 0.0 nan nan nan nan nan ... 4.167 0.0 2.632 7.576 9.091 10.94</span></div><div class='xr-array-data'><pre>array([[[ 2.94117647,  0.        ,         nan, ...,  0.        ,
          0.        ,  1.38888889],
        [ 4.54545455,  0.        ,  7.89473684, ...,         nan,
                 nan,  0.        ],
        [ 0.        ,  0.        ,         nan, ...,         nan,
                 nan,  0.        ],
        ...,
        [ 0.        ,  0.        ,  0.        , ...,  0.        ,
          0.        ,  0.94339623],
        [ 0.        ,  4.16666667,  0.        , ...,  0.        ,
          0.        ,  2.7173913 ],
        [ 0.        ,  4.54545455,  0.        , ...,  4.54545455,
          0.90909091,  1.5625    ]],

       [[ 0.        ,  2.94117647,         nan, ...,  0.        ,
          0.        ,  0.        ],
        [ 0.        ,  0.52083333,  0.        , ...,         nan,
                 nan,  0.        ],
        [ 0.        ,  0.        ,         nan, ...,         nan,
                 nan,  0.        ],
...
        [ 0.        ,  0.        ,  8.33333333, ...,  7.44680851,
          5.        ,  3.4591195 ],
        [ 6.25      ,  0.        ,  0.92592593, ..., 12.06896552,
          3.48837209,  4.89130435],
        [ 0.        ,  0.        ,  0.        , ...,  9.09090909,
          4.54545455,  3.90625   ]],

       [[ 2.94117647,  0.        ,         nan, ...,  0.        ,
          0.        ,  2.77777778],
        [ 0.        ,  0.52083333,  0.        , ...,         nan,
                 nan,  0.        ],
        [ 0.        ,  0.        ,         nan, ...,         nan,
                 nan,  0.        ],
        ...,
        [ 0.        ,  0.        ,  0.        , ...,  5.31914894,
          5.        ,  1.88679245],
        [ 6.25      ,  0.        ,  8.33333333, ...,  0.        ,
          0.        ,  0.54347826],
        [ 9.52380952,  6.81818182,  3.84615385, ...,  7.57575758,
          9.09090909, 10.9375    ]]], shape=(6, 40, 40))</pre></div></div></li><li class='xr-section-item'><input id='section-15e5598d-61ad-4a03-9489-9e3a04a004ec' class='xr-section-summary-in' type='checkbox'  checked><label for='section-15e5598d-61ad-4a03-9489-9e3a04a004ec' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>unit</span></div><div class='xr-var-dims'>(unit)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 5</div><input id='attrs-92423a2c-8082-4b95-a2b8-41e788a74e35' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-92423a2c-8082-4b95-a2b8-41e788a74e35' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1bc27935-be84-4738-9a67-2cac8d7b9a33' class='xr-var-data-in' type='checkbox'><label for='data-1bc27935-be84-4738-9a67-2cac8d7b9a33' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([0, 1, 2, 3, 4, 5])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>X</span></div><div class='xr-var-dims'>(X)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-48.75 -46.25 ... 46.25 48.75</div><input id='attrs-c1d1bf23-2758-4e05-9abc-53693374a1c6' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-c1d1bf23-2758-4e05-9abc-53693374a1c6' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-cabed16f-e235-4746-a8cb-507a9a1f73c3' class='xr-var-data-in' type='checkbox'><label for='data-cabed16f-e235-4746-a8cb-507a9a1f73c3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([-48.75, -46.25, -43.75, -41.25, -38.75, -36.25, -33.75, -31.25, -28.75,
       -26.25, -23.75, -21.25, -18.75, -16.25, -13.75, -11.25,  -8.75,  -6.25,
        -3.75,  -1.25,   1.25,   3.75,   6.25,   8.75,  11.25,  13.75,  16.25,
        18.75,  21.25,  23.75,  26.25,  28.75,  31.25,  33.75,  36.25,  38.75,
        41.25,  43.75,  46.25,  48.75])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>Y</span></div><div class='xr-var-dims'>(Y)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-48.75 -46.25 ... 46.25 48.75</div><input id='attrs-90c3a445-239d-413a-a52b-5ee5467c10fb' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-90c3a445-239d-413a-a52b-5ee5467c10fb' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3073a347-339f-4e9b-9d03-d54465fa4bc3' class='xr-var-data-in' type='checkbox'><label for='data-3073a347-339f-4e9b-9d03-d54465fa4bc3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([-48.75, -46.25, -43.75, -41.25, -38.75, -36.25, -33.75, -31.25, -28.75,
       -26.25, -23.75, -21.25, -18.75, -16.25, -13.75, -11.25,  -8.75,  -6.25,
        -3.75,  -1.25,   1.25,   3.75,   6.25,   8.75,  11.25,  13.75,  16.25,
        18.75,  21.25,  23.75,  26.25,  28.75,  31.25,  33.75,  36.25,  38.75,
        41.25,  43.75,  46.25,  48.75])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-68962626-474b-40e2-9334-0415dc6ad86c' class='xr-section-summary-in' type='checkbox'  ><label for='section-68962626-474b-40e2-9334-0415dc6ad86c' class='xr-section-summary' >Attributes: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>occupancy :</span></dt><dd>[[ 17.  17.  nan ...  22.  11.  36.]
 [ 11.  96.  19. ...  nan  nan   8.]
 [ 14.  10.  nan ...  nan  nan   9.]
 ...
 [  5.  13.  12. ...  47.  10. 159.]
 [  8.  12.  54. ...  29.  43.  92.]
 [ 42.  22.  13. ...  33.  55.  64.]]</dd><dt><span>bin_edges :</span></dt><dd>[array([-50. , -47.5, -45. , -42.5, -40. , -37.5, -35. , -32.5, -30. ,
       -27.5, -25. , -22.5, -20. , -17.5, -15. , -12.5, -10. ,  -7.5,
        -5. ,  -2.5,   0. ,   2.5,   5. ,   7.5,  10. ,  12.5,  15. ,
        17.5,  20. ,  22.5,  25. ,  27.5,  30. ,  32.5,  35. ,  37.5,
        40. ,  42.5,  45. ,  47.5,  50. ]), array([-50. , -47.5, -45. , -42.5, -40. , -37.5, -35. , -32.5, -30. ,
       -27.5, -25. , -22.5, -20. , -17.5, -15. , -12.5, -10. ,  -7.5,
        -5. ,  -2.5,   0. ,   2.5,   5. ,   7.5,  10. ,  12.5,  15. ,
        17.5,  20. ,  22.5,  25. ,  27.5,  30. ,  32.5,  35. ,  37.5,
        40. ,  42.5,  45. ,  47.5,  50. ])]</dd><dt><span>fs :</span></dt><dd>50.0</dd><dt><span>rates :</span></dt><dd>[2.01340045 0.90169672 0.77002567 1.23504117 0.85836195 0.91003033]</dd></dl></div></li></ul></div></div></div></div>
</div>
<p>We can further also compute our metric of interest.
In this case, we are interested in the modulation of the neurons‚Äô firing by position.
A metric that is typically used to quantify this is the mutual information, often called <a class="reference external" href="https://proceedings.neurips.cc/paper/1992/hash/5dd9db5e033da9c6fb5ba83c7a7ebea9-Abstract.html">spatial information</a> for this case specifically:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spatial_information</span> <span class="o">=</span> <span class="n">nap</span><span class="o">.</span><span class="n">compute_mutual_information</span><span class="p">(</span><span class="n">tuning_curves</span><span class="p">)</span>
<span class="n">spatial_information</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bits/sec</th>
      <th>bits/spike</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.797138</td>
      <td>1.389261</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.408331</td>
      <td>2.670888</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.412850</td>
      <td>3.133467</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3.301270</td>
      <td>2.673004</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.965672</td>
      <td>2.290027</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.832783</td>
      <td>2.013981</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can visualize all that together:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">tuning_curves_smooth</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s2">&quot;unit&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="n">unit_idx</span><span class="p">,</span> <span class="n">unit_id</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">,</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">units</span><span class="p">)):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unit=</span><span class="si">{</span><span class="n">unit_id</span><span class="si">}</span><span class="se">\n</span><span class="s2">SI=</span><span class="si">{</span><span class="n">spatial_information</span><span class="p">[</span><span class="s1">&#39;bits/spike&#39;</span><span class="p">][</span><span class="n">unit_idx</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6bb5e597a2b34f22e03f336db70c601787433e504b82ff76fc36fd2510ea1443.png" src="../_images/6bb5e597a2b34f22e03f336db70c601787433e504b82ff76fc36fd2510ea1443.png" />
</div>
</div>
<p>Some of these units seem to have clear spatial firing (e.g. unit 3), with localized firing fields and relatively high spatial information values.
However, for units like unit 0 we can not say for certain that the pattern we see is not just caused by random activity.</p>
</section>
<hr class="docutils" />
<section id="randomization">
<h2>Randomization<a class="headerlink" href="#randomization" title="Link to this heading">#</a></h2>
<p>Next, we can start thinking about null distributions.
Our ultimate goal is to be able to say that a neuron‚Äôs activity is significantly modulated by position.
To do that, we want to contrast it to the activity of a neuron that is not modulated by position at all.
But how do we pick that neuron?
We do not want to stray away from the firing patterns of our neuron of interest too much, so we can‚Äôt just pick something arbitrary.</p>
<p>In practice, we will often take the activity of our neuron of interest and shuffle it somehow, thereby breaking the relation with our variable of interest (position), but keeping its general firing statistics as much as possible.</p>
<p>Pynapple provides four methods for such shuffling:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../generated/pynapple.process.randomize.html#pynapple.process.randomize.jitter_timestamps" title="pynapple.process.randomize.jitter_timestamps"><span class="xref myst py py-func"><code class="docutils literal notranslate"><span class="pre">jitter_timestamps</span></code></span></a>: jitters timestamps independently by random amounts uniformly drawn from a given range.</p></li>
<li><p><a class="reference internal" href="../generated/pynapple.process.randomize.html#pynapple.process.randomize.resample_timestamps" title="pynapple.process.randomize.resample_timestamps"><span class="xref myst py py-func"><code class="docutils literal notranslate"><span class="pre">resample_timestamps</span></code></span></a>: uniformly resamples all timestamps within the time support.</p></li>
<li><p><a class="reference internal" href="../generated/pynapple.process.randomize.html#pynapple.process.randomize.shift_timestamps" title="pynapple.process.randomize.shift_timestamps"><span class="xref myst py py-func"><code class="docutils literal notranslate"><span class="pre">shift_timestamps</span></code></span></a>: shifts all timestamps by a random amount drawn from a given range, wrapping the end of the time support to the beginning.</p></li>
<li><p><a class="reference internal" href="../generated/pynapple.process.randomize.html#pynapple.process.randomize.shuffle_ts_intervals" title="pynapple.process.randomize.shuffle_ts_intervals"><span class="xref myst py py-func"><code class="docutils literal notranslate"><span class="pre">shuffle_ts_intervals</span></code></span></a>: randomizes timestamps by shuffling the intervals between them.</p></li>
</ul>
<p>Let‚Äôs apply them to an example neuron:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jitter</span> <span class="o">=</span> <span class="n">nap</span><span class="o">.</span><span class="n">jitter_timestamps</span><span class="p">(</span><span class="n">units</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">max_jitter</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">resample</span> <span class="o">=</span> <span class="n">nap</span><span class="o">.</span><span class="n">resample_timestamps</span><span class="p">(</span><span class="n">units</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">shift</span> <span class="o">=</span> <span class="n">nap</span><span class="o">.</span><span class="n">shift_timestamps</span><span class="p">(</span><span class="n">units</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">min_shift</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
<span class="n">interval_shuffle</span> <span class="o">=</span> <span class="n">nap</span><span class="o">.</span><span class="n">shuffle_ts_intervals</span><span class="p">(</span><span class="n">units</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>and plot them to look at their effect on spatial firing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="p">(</span><span class="n">ax_spikes</span><span class="p">,</span> <span class="n">ax_tc</span><span class="p">,</span> <span class="n">ax_corr</span><span class="p">),</span> <span class="p">(</span><span class="n">randomization_type</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="n">units</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;jitter&quot;</span><span class="p">,</span> <span class="n">jitter</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;resample&quot;</span><span class="p">,</span> <span class="n">resample</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;shift&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;interval_shuffle&quot;</span><span class="p">,</span> <span class="n">interval_shuffle</span><span class="p">),</span>
    <span class="p">],</span>
<span class="p">):</span>
    <span class="c1"># Plot spike positions</span>
    <span class="n">ax_spikes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">position</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">position</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">positional_spikes</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">value_from</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
    <span class="n">ax_spikes</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">positional_spikes</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">positional_spikes</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
        <span class="n">s</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
    <span class="n">ax_spikes</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_inverted</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax_spikes</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">ax_spikes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">randomization_type</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>

    <span class="c1"># Plot tuning curve</span>
    <span class="n">tuning_curve</span> <span class="o">=</span> <span class="n">nap</span><span class="o">.</span><span class="n">compute_tuning_curves</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">features</span><span class="o">=</span><span class="n">position</span><span class="p">,</span>
        <span class="n">feature_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">],</span>
        <span class="nb">range</span><span class="o">=</span><span class="p">[(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)],</span>
        <span class="n">bins</span><span class="o">=</span><span class="mi">40</span>
    <span class="p">)</span>
    <span class="n">tuning_curve</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">gaussian_filter_nan</span><span class="p">(</span><span class="n">tuning_curve</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">ax_tc</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tuning_curve</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
    <span class="n">ax_tc</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

    <span class="c1"># Plot 2D autocorrelation</span>
    <span class="n">ax_corr</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">correlate2d</span><span class="p">(</span><span class="n">tuning_curve</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tuning_curve</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">)</span>
    <span class="n">ax_corr</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.44</span><span class="p">,</span> <span class="s2">&quot;tuning</span><span class="se">\n</span><span class="s2">curve&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="s2">&quot;auto</span><span class="se">\n</span><span class="s2">correlation&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/1a2abee1a6239cb092cbd465d3819dadff4348cdd65ba1520c4db3cde4d8d561.png" src="../_images/1a2abee1a6239cb092cbd465d3819dadff4348cdd65ba1520c4db3cde4d8d561.png" />
</div>
</div>
<p>We are also visualizing the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.correlate2d.html">two-dimensional autocorrelation</a>
of the tuning curves here to highlight the breaking/maintaining of patterns.</p>
<p>Each of these methods seem to have different effects:</p>
<ul class="simple">
<li><p><strong>Jittering</strong>: does exactly that, the jitter in time also results in a jitter in position.
We set the maximal jitter to 2 seconds, which likely matches the timescale of the movements of the animal.
The tuning curve and autocorrelation have not changed a lot, meaning we have not broken the relation between spiking and behavior.
Thus, jittering might not be a good randomization method in this case, unless we increase the maximal jitter.</p></li>
<li><p><strong>Resampling</strong>: gives us a uniform spread in position, the relation between spiking and behaviour is gone entirely.</p></li>
<li><p><strong>Shifting</strong>: has the advantage of keeping the temporal relations between spikes, while only breaking the relation with position.</p></li>
<li><p><strong>Shuffling interspike intervals</strong>: looks similar to shifting, it keeps the overall interspike interval distribution.</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="null-distributions">
<h2>Null distributions<a class="headerlink" href="#null-distributions" title="Link to this heading">#</a></h2>
<p>We will opt for random shifts.
For each neuron, we will generate <code class="docutils literal notranslate"><span class="pre">N</span></code> pseudo-neurons and compute the mutual/spatial information.
The resulting distributions of values are what we call the null distributions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">shuffles</span> <span class="o">=</span> <span class="p">[</span><span class="n">nap</span><span class="o">.</span><span class="n">shift_timestamps</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">min_shift</span><span class="o">=</span><span class="mf">20.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>

<span class="n">null_distributions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">nap</span><span class="o">.</span><span class="n">compute_mutual_information</span><span class="p">(</span>
            <span class="n">nap</span><span class="o">.</span><span class="n">compute_tuning_curves</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="n">shuffle</span><span class="p">,</span>
                <span class="n">features</span><span class="o">=</span><span class="n">position</span><span class="p">,</span>
                <span class="nb">range</span><span class="o">=</span><span class="p">[(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)],</span>
                <span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)[</span><span class="s2">&quot;bits/spike&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">for</span> <span class="n">shuffle</span> <span class="ow">in</span> <span class="n">shuffles</span>
    <span class="p">],</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">null_distributions</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(6, 500)
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Link to this heading">#</a></h2>
<p>Ultimately, we will apply the test.
From a statistical view, we see the null distribution as an empirical distribution of spatial information values that would be expected if the neuron‚Äôs firing were unrelated to spatial position.
We want to determine how unlikely it is that the observed spatial information arose from our null distribution.</p>
<p>Given a significance level, Œ±, we assess whether the observed value lies in the extreme tail of the null distribution.
If the probability (the p-value) of obtaining a spatial information value <strong>as large as or larger than</strong> the observed one is less than Œ±, we reject the null hypothesis:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="c1"># significance level</span>
<span class="n">p_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
    <span class="n">null_distributions</span><span class="o">.</span><span class="n">T</span> <span class="o">&gt;=</span> <span class="n">spatial_information</span><span class="p">[</span><span class="s1">&#39;bits/spike&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
    <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span> <span class="o">/</span> <span class="n">null_distributions</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">spatial_units</span> <span class="o">=</span> <span class="n">tuning_curves</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;unit&quot;</span><span class="p">][</span><span class="n">p_values</span> <span class="o">&gt;</span> <span class="n">alpha</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>We can further also compute the exact spatial information values corresponding to our alpha:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">thresholds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">null_distributions</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, we can visualize everything together:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">tuning_curves_smooth</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s2">&quot;unit&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="n">unit_idx</span><span class="p">,</span> <span class="n">unit_id</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">,</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">units</span><span class="p">)):</span>
    <span class="n">null</span> <span class="o">=</span> <span class="n">null_distributions</span><span class="p">[</span><span class="n">unit_idx</span><span class="p">]</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">spatial_information</span><span class="p">[</span><span class="s1">&#39;bits/spike&#39;</span><span class="p">][</span><span class="n">unit_idx</span><span class="p">]</span>
    <span class="n">pval</span> <span class="o">=</span> <span class="n">p_values</span><span class="p">[</span><span class="n">unit_idx</span><span class="p">]</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unit=</span><span class="si">{</span><span class="n">unit_id</span><span class="si">}</span><span class="se">\n</span><span class="s2">SI=</span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">p=</span><span class="si">{</span><span class="n">pval</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}{</span><span class="s1">&#39;*&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">score</span><span class="o">&gt;</span><span class="n">thresholds</span><span class="p">[</span><span class="n">unit_idx</span><span class="p">]</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">ax_hist</span> <span class="o">=</span> <span class="n">inset_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;40%&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower center&quot;</span><span class="p">,</span>
                         <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">bbox_transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="n">ax_hist</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">null</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s2">&quot;stepfilled&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">ax_hist</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">thresholds</span><span class="p">[</span><span class="n">unit_idx</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="n">ax_hist</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
    <span class="n">ax_hist</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax_hist</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">unit_idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ax_hist</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;spatial</span><span class="se">\n</span><span class="s2">information</span><span class="se">\n</span><span class="s2">(bits/spike)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/562485bae90f1d2d8de6041ba5362293fffd8652a240cb4b2bf83e114e10fd47.png" src="../_images/562485bae90f1d2d8de6041ba5362293fffd8652a240cb4b2bf83e114e10fd47.png" />
</div>
</div>
<p>We can see that all our units are significantly modulated by position, some more so than others.
By visualizing the null distributions (blue histograms), the percentile thresholds (black lines), and the actual values (dashed red lines), we can get more nuance.
We now also have approximate p-values to report.</p>
<!-- #region -->
<div class="sd-card sd-sphinx-override sd-mb-3 sd-shadow-sm docutils">
<div class="sd-card-header docutils">
<p class="sd-card-text">Authors</p>
</div>
<div class="sd-card-body docutils">
<p class="sd-card-text">Wolf De Wulf</p>
</div>
</div>
<!-- #endregion --></section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="tutorial_pynapple_dandi.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Streaming data from DANDI</p>
      </div>
    </a>
    <a class="right-next"
       href="tutorial_calcium_imaging.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Calcium Imaging</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-data-from-dandi">Downloading data from DANDI</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-tuning-curves">Spatial tuning curves</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#randomization">Randomization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#null-distributions">Null distributions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/examples/tutorial_null_distributions.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

<footer class="footer" style="border-top: 1px solid #ccc; padding-top: 10px">
  <div class="container">
    <div id="credits" style="width: 50%; float: left">
      <p>
      &#169; Copyright 2021-2025, <a href="https://www.simonsfoundation.org/people/guillaume-viejo/">pynapple authors</a>.<br/>
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> and the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/">PyData Theme</a>.<br/>
      </p>
    </div>
    <div id="version" style="color: #999; float: right; margin: 15px">v0.10.2</div>
    </div>
  </div>
</footer>
  </body>
</html>